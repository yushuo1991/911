<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¶¨åœæ—¶é—´æ•°æ®è¯Šæ–­</title>
  <style>
    body {
      font-family: 'Microsoft YaHei', sans-serif;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      color: #333;
    }
    button {
      padding: 10px 20px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: #45a049;
    }
    #result {
      margin-top: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #4CAF50;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    .error {
      color: red;
      font-weight: bold;
    }
    .success {
      color: green;
      font-weight: bold;
    }
    .warning {
      color: orange;
      font-weight: bold;
    }
    pre {
      background: #f4f4f4;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>æ¶¨åœæ—¶é—´æ•°æ®ç»“æ„è¯Šæ–­å·¥å…·</h1>
  
  <div>
    <label for="dateInput">é€‰æ‹©æ—¥æœŸï¼š</label>
    <input type="date" id="dateInput" value="2024-10-16">
    <button onclick="fetchData()">è·å–æ•°æ®</button>
  </div>

  <div id="result"></div>

  <script>
    async function fetchData() {
      const dateInput = document.getElementById('dateInput');
      const date = dateInput.value.replace(/-/g, '');
      const resultDiv = document.getElementById('result');
      
      resultDiv.innerHTML = '<p>æ­£åœ¨è·å–æ•°æ®...</p>';
      
      try {
        const url = 'https://apphis.longhuvip.com/w1/api/index.php';
        const formData = new URLSearchParams({
          Date: date,
          Index: '0',
          PhoneOSNew: '2',
          VerSion: '5.21.0.1',
          a: 'GetPlateInfo_w38',
          apiv: 'w42',
          c: 'HisLimitResumption',
          st: '20'
        });

        const response = await fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8',
            'Accept': '*/*',
          },
          body: formData,
        });

        if (!response.ok) {
          throw new Error(`HTTPé”™è¯¯! çŠ¶æ€: ${response.status}`);
        }

        const data = await response.json();
        
        let html = '<h2 class="success">âœ… æ•°æ®è·å–æˆåŠŸ</h2>';
        
        // æ˜¾ç¤ºæ€»ä½“ä¿¡æ¯
        html += `<div><strong>æ€»æ¶¨åœæ•°ï¼š</strong>${data.nums?.ZT || 0}</div>`;
        html += `<div><strong>æ¿å—æ•°é‡ï¼š</strong>${data.list?.length || 0}</div>`;
        
        // åˆ†ææ•°æ®ç»“æ„
        if (data.list && Array.isArray(data.list)) {
          const firstSector = data.list[0];
          if (firstSector && firstSector.StockList && firstSector.StockList.length > 0) {
            const firstStock = firstSector.StockList[0];
            
            html += '<h3>ğŸ“Š ç¬¬ä¸€ä¸ªè‚¡ç¥¨çš„å®Œæ•´æ•°ç»„ç»“æ„</h3>';
            html += '<pre>' + JSON.stringify(firstStock, null, 2) + '</pre>';
            html += '<table>';
            html += '<tr><th>ç´¢å¼•</th><th>å€¼</th><th>è¯´æ˜</th></tr>';
            for (let i = 0; i < Math.min(15, firstStock.length); i++) {
              let description = '';
              switch(i) {
                case 0: description = 'è‚¡ç¥¨ä»£ç '; break;
                case 1: description = 'è‚¡ç¥¨åç§°'; break;
                case 6: description = 'æˆäº¤é¢ï¼ˆå…ƒï¼‰'; break;
                case 7: description = 'æ¶¨åœæ—¶é—´ï¼Ÿ'; break;
                case 9: description = 'æ¿ä½ç±»å‹'; break;
                default: description = 'æœªçŸ¥';
              }
              html += `<tr><td>[${i}]</td><td>${firstStock[i]}</td><td>${description}</td></tr>`;
            }
            html += '</table>';
          }
          
          // æ£€æŸ¥èŠ¯ç‰‡æ¿å—
          const chipSector = data.list.find(cat => cat.ZSName === 'èŠ¯ç‰‡');
          if (chipSector && chipSector.StockList) {
            html += '<h3>ğŸ” èŠ¯ç‰‡æ¿å—ä¸ªè‚¡åˆ—è¡¨</h3>';
            html += '<table>';
            html += '<tr><th>åºå·</th><th>è‚¡ç¥¨ä»£ç </th><th>è‚¡ç¥¨åç§°</th><th>æ¿ä½ç±»å‹</th><th>ç´¢å¼•[7]å€¼</th><th>æˆäº¤é¢(å…ƒ)</th></tr>';
            
            chipSector.StockList.forEach((stock, index) => {
              html += `<tr>
                <td>${index + 1}</td>
                <td>${stock[0]}</td>
                <td>${stock[1]}</td>
                <td>${stock[9]}</td>
                <td class="${stock[7] && stock[7] !== '09:30' ? 'success' : 'warning'}">${stock[7] || 'æœªå®šä¹‰'}</td>
                <td>${stock[6]}</td>
              </tr>`;
            });
            html += '</table>';
            
            // ç»Ÿè®¡æ¶¨åœæ—¶é—´åˆ†å¸ƒ
            const timeMap = new Map();
            chipSector.StockList.forEach(stock => {
              const time = stock[7] || 'æœªå®šä¹‰';
              timeMap.set(time, (timeMap.get(time) || 0) + 1);
            });
            
            html += '<h4>æ¶¨åœæ—¶é—´åˆ†å¸ƒç»Ÿè®¡</h4>';
            html += '<table>';
            html += '<tr><th>æ—¶é—´</th><th>æ•°é‡</th></tr>';
            Array.from(timeMap.entries()).sort((a, b) => a[0].localeCompare(b[0])).forEach(([time, count]) => {
              html += `<tr><td>${time}</td><td>${count}</td></tr>`;
            });
            html += '</table>';
            
            // è¯Šæ–­ç»“è®º
            html += '<h3>ğŸ“‹ è¯Šæ–­ç»“è®º</h3>';
            if (timeMap.size === 1 && timeMap.has('09:30')) {
              html += '<p class="error">âŒ æ‰€æœ‰è‚¡ç¥¨çš„ç´¢å¼•[7]å€¼éƒ½æ˜¯"09:30"ï¼Œå¯èƒ½æ˜¯é»˜è®¤å€¼æˆ–è¯¥ç´¢å¼•ä¸æ˜¯æ¶¨åœæ—¶é—´</p>';
              html += '<p class="warning">âš ï¸ å»ºè®®æ£€æŸ¥å…¶ä»–ç´¢å¼•ä½ç½®æ˜¯å¦åŒ…å«æ¶¨åœæ—¶é—´æ•°æ®</p>';
            } else if (timeMap.size === 1) {
              html += '<p class="warning">âš ï¸ æ‰€æœ‰è‚¡ç¥¨çš„ç´¢å¼•[7]å€¼ç›¸åŒï¼Œéœ€è¦è¿›ä¸€æ­¥éªŒè¯</p>';
            } else {
              html += '<p class="success">âœ… ç´¢å¼•[7]åŒ…å«ä¸åŒçš„æ—¶é—´å€¼ï¼Œå¯èƒ½ç¡®å®æ˜¯æ¶¨åœæ—¶é—´å­—æ®µ</p>';
            }
          } else {
            html += '<p class="warning">âš ï¸ æœªæ‰¾åˆ°èŠ¯ç‰‡æ¿å—</p>';
          }
        }
        
        resultDiv.innerHTML = html;
        
      } catch (error) {
        resultDiv.innerHTML = `<p class="error">âŒ é”™è¯¯: ${error.message}</p>`;
        console.error('è¯¦ç»†é”™è¯¯:', error);
      }
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–æ•°æ®
    window.addEventListener('DOMContentLoaded', () => {
      fetchData();
    });
  </script>
</body>
</html>


