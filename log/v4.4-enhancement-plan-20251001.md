# v4.4 增强版本 - 实施计划

## 版本信息
- **版本号**: v4.4
- **基于**: v4.3.1 (骨架屏优化版)
- **计划日期**: 2025-10-01
- **实施方式**: 顺序实施5大需求

---

## 📋 需求清单

### ✅ 需求4: 日期弹窗改版 (已完成)
**状态**: 用户已手动实现
**位置**: src/app/page.tsx 行96-152
**功能**:
- 显示当天板块平均溢价前5名
- 按5天总和降序排列
- 表格显示5天具体日期

---

### 🔄 需求1: 字体统一协调
**状态**: 准备实施
**目标**: 统一全局字体大小，提升视觉协调性

**字体体系**:
```
页面标题: text-xl (20px)
模态框标题: text-lg (18px)
卡片标题: text-sm (14px)
主要内容: text-xs (12px)
辅助文本/标签: text-2xs (10px)
超紧凑文本: text-[10px]
```

**修改位置**:
1. 骨架屏loading toast: text-sm → 保持
2. 页面标题: text-xl → 保持
3. 日期头部: text-xs, text-2xs → 保持
4. 板块卡片: text-xs, text-2xs → 保持
5. 模态框标题: text-lg → 统一
6. 表格内容: text-xs, text-2xs → 统一
7. 按钮文字: text-xs → 统一

---

### 🔄 需求2: 板块弹窗改版
**状态**: 准备实施
**位置**: src/app/page.tsx 行438-530

**左侧表格新增**:
1. **第2列 - 当日板数**:
   - 从API数据推断连板数（如果有）
   - 格式: "2" 或 "5天4"
   - 备选: 暂时显示"-"或"1"（首板）

2. **表头改进**:
   - 第3-7列改为具体日期（09-24、09-25...）
   - 表头下方显示该日板块平均涨跌幅

3. **右上角筛选**:
   - 新增按钮: "显示涨幅>10%"
   - 新增状态: showOnly10PlusInSectorModal
   - 筛选逻辑: filter(stock => totalReturn > 10)

**右侧图表**:
- 横轴T+1改为具体日期
- 修改chartHelpers.ts的date处理

---

### 🔄 需求3: 涨停数弹窗优化
**状态**: 准备实施
**位置**: src/app/page.tsx 行728-860

**布局改版**:
```
原布局: 单列垂直堆叠
新布局: 2-3列网格并排

┌─────────────┬─────────────┬─────────────┐
│ 芯片 (8只)  │ 医药 (6只)  │ 新能源 (5只)│
│ [紧凑表格]  │ [紧凑表格]  │ [紧凑表格]  │
├─────────────┼─────────────┼─────────────┤
│ 消费 (7只)  │ 科技 (9只)  │ 金融 (4只)  │
│ [紧凑表格]  │ [紧凑表格]  │ [紧凑表格]  │
└─────────────┴─────────────┴─────────────┘
```

**样式调整**:
- 外层: `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3`
- 字体: text-2xs (10px), text-[10px]
- 间距: p-1.5, gap-1
- 表格: 超紧凑样式

**日期修正**:
- T+1、T+2 → 09-24、09-25
- 使用dates数组获取实际日期

---

### 🔄 需求5: 排行榜弹窗横向改版
**状态**: 准备实施
**位置**: src/app/page.tsx 行980-1040

**布局改版**:
```
原布局: 垂直时间线（每天一个卡片）
新布局: 横向表格

┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│ 09-23   │ 09-24   │ 09-25   │ 09-26   │ 09-27   │ 09-30   │ 10-01   │
│ (8只)   │ (10只)  │ (5只)   │ (7只)   │ (6只)   │ (9只)   │ (4只)   │
├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│赣锋锂业2│迈瑞医疗2│天齐锂业1│宁德时代1│比亚迪1  │隆基绿能1│TCL科技1 │
│天齐锂业1│比亚迪1  │赣锋锂业3│赣锋锂业4│赣锋锂业5│赣锋锂业6│         │
│伊利股份1│伊利股份2│         │         │         │         │         │
└─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘
```

**交互功能**:
- 点击任意日期列
- 触发handleDateColumnClick(date, stocks, sectorName)
- 弹出该日期个股后续5天溢价详情
- 复用板块弹窗的表格格式

**技术实现**:
- 用户已添加handleDateColumnClick函数（行289-318）
- 用户已添加showDateColumnDetail状态（行42-43）
- 需要修改7天阶梯弹窗UI为横向表格

---

## 🛠️ 实施顺序

### 阶段1: 字体统一 (15分钟)
1. 审查全部text-*类
2. 统一同级元素字体
3. 验证视觉协调性

### 阶段2: 板块弹窗改版 (30分钟)
1. 添加"当日板数"列
2. 表头改为具体日期
3. 添加板块平均涨跌幅
4. 右上角筛选按钮
5. 图表日期修正

### 阶段3: 涨停数弹窗优化 (20分钟)
1. 改为网格布局（2-3列）
2. 缩小字体和间距
3. 日期T+1改为具体日期
4. 测试响应式布局

### 阶段4: 排行榜弹窗横向改版 (30分钟)
1. 改为横向表格布局
2. 每列显示该日涨停个股+板数
3. 添加日期列点击事件
4. 实现嵌套弹窗（日期详情）

### 阶段5: 测试和优化 (20分钟)
1. 本地测试所有功能
2. 验证数据正确性
3. 检查响应式布局
4. 修复bug

### 阶段6: 备份和部署 (15分钟)
1. Git commit详细提交信息
2. 创建v4.4标签
3. 推送到GitHub
4. SSH部署到服务器
5. 清理Nginx缓存
6. 验证生产环境

**总预计时间**: 2小时10分钟

---

## 📊 数据处理说明

### 当日板数获取方案
由于API可能不直接提供连板数，采用以下方案：

**方案A**: 推断连板数
- 如果stock.name包含"N"开头 → 首板
- 检查前一天是否也涨停 → 2板
- 递归检查前N天 → N板

**方案B**: 暂时默认值
- 所有个股默认显示"1"（首板）
- 后续优化时添加真实连板数

**采用**: 方案B（简单可靠）

### 具体日期计算
使用现有dates数组：
```typescript
const currentDateIndex = dates.indexOf(date);
const next5Days = dates.slice(currentDateIndex + 1, currentDateIndex + 6);

// 格式化日期
const formattedDate = formatDate(nextDay).slice(5); // "09-24"
```

---

## ⚠️ 注意事项

1. **不破坏现有功能**: 所有修改只增强UI，不改变数据逻辑
2. **保持数据结构**: followUpData格式不变
3. **向后兼容**: 旧数据也能正常显示
4. **响应式设计**: 确保移动端可用
5. **性能优化**: 避免添加昂贵计算

---

## 🎨 设计原则

1. **紧凑高端**: 减少无效留白，信息密度高
2. **精致美观**: 统一配色，清晰层级
3. **易于扫描**: 表格对齐，颜色编码
4. **交互流畅**: 动画过渡，响应迅速

---

**文档生成时间**: 2025-10-01
**状态**: 准备实施
