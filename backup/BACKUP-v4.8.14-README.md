# v4.8.14 å¤‡ä»½è¯´æ˜ - åˆ†æ—¶å›¾åŠŸèƒ½å®Œæ•´ç‰ˆ

## å¤‡ä»½ä¿¡æ¯

- **ç‰ˆæœ¬**: v4.8.14-minute-chart-20251013
- **å¤‡ä»½æ—¶é—´**: 2025-10-13
- **Gitæäº¤**: f791f50
- **Gitæ ‡ç­¾**: v4.8.14-minute-chart-20251013
- **æœ¬åœ°å¤‡ä»½**: backup/v4.8.14-minute-chart-20251013.tar.gz
- **åŠŸèƒ½ç‰¹æ€§**: åˆ†æ—¶å›¾æ‰¹é‡å±•ç¤º + å•è‚¡åˆ†æ—¶+Kçº¿åˆ†å±

---

## ç‰ˆæœ¬ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½

#### 1. ç‹¬ç«‹åˆ†æ—¶å›¾æ‰¹é‡å±•ç¤ºå¼¹çª— â­
- **å±‚çº§**: z-index: 90 (æœ€é«˜å±‚)
- **å°ºå¯¸**: 98vw Ã— 95vh (å…¨å±æ˜¾ç¤º)
- **å¸ƒå±€**: 3-4åˆ—å“åº”å¼ç½‘æ ¼
- **åˆ†é¡µ**: æ¯é¡µ12åªä¸ªè‚¡
- **ä¸»é¢˜**: ç»¿è‰²ç³»(åŒºåˆ«äºKçº¿çš„è“è‰²ç³»)
- **API**: `http://image.sinajs.cn/newchart/min/n/{sh/sz}code.gif`

#### 2. æ¿å—è¯¦æƒ…å¼¹çª—åˆ†æ—¶æŒ‰é’®
- **æŒ‰é’®**: ğŸ“Š ä»Šæ—¥åˆ†æ—¶
- **ä½ç½®**: å³ä¸Šè§’ï¼Œ"æ˜¾ç¤ºKçº¿"æŒ‰é’®å·¦ä¾§
- **é¢œè‰²**: bg-green-600 (ç»¿è‰²)
- **åŠŸèƒ½**: æ‰“å¼€è¯¥æ¿å—ç‹¬ç«‹åˆ†æ—¶å›¾å¼¹çª—

#### 3. æ¶¨åœæ•°å¼¹çª—æ¿å—æ ‡é¢˜åˆ†æ—¶æŒ‰é’®
- **æŒ‰é’®**: ğŸ“ŠM (Miniç‰ˆ)
- **ä½ç½®**: æ¯ä¸ªæ¿å—æ ‡é¢˜å³ä¾§ï¼ŒKçº¿æŒ‰é’®å·¦ä¾§
- **é¢œè‰²**: bg-green-100 (æµ…ç»¿è‰²)
- **åŠŸèƒ½**: æ‰“å¼€è¯¥æ¿å—ç‹¬ç«‹åˆ†æ—¶å›¾å¼¹çª—

#### 4. å•è‚¡å¼¹çª—åˆ†æ—¶+Kçº¿åˆ†å±æ˜¾ç¤º â­â­
- **åŸåŠŸèƒ½**: ç‚¹å‡»è‚¡ç¥¨åç§°åªæ˜¾ç¤ºKçº¿å›¾
- **æ–°åŠŸèƒ½**: å·¦ä¾§50%åˆ†æ—¶å›¾ + å³ä¾§50%Kçº¿å›¾
- **æ ‡é¢˜**: "{è‚¡ç¥¨åç§°} ({ä»£ç }) ä»Šæ—¥åˆ†æ—¶ & Kçº¿å›¾"
- **å¸ƒå±€**: CSS Grid `grid-cols-2`
- **æ ‡è¯†**: ç»¿è‰²å¾½ç« (åˆ†æ—¶) + è“è‰²å¾½ç« (Kçº¿)

### æŠ€æœ¯æ”¹è¿›

#### çŠ¶æ€ç®¡ç†
```typescript
// æ–°å¢åˆ†æ—¶å›¾çŠ¶æ€ (lines 52-55)
const [showMinuteModal, setShowMinuteModal] = useState(false);
const [minuteModalData, setMinuteModalData] = useState<{
  sectorName: string,
  date: string,
  stocks: StockPerformance[]
} | null>(null);
const [minuteModalPage, setMinuteModalPage] = useState(0);
```

#### å¤„ç†å‡½æ•°
```typescript
// æ‰“å¼€/å…³é—­åˆ†æ—¶å›¾å¼¹çª— (lines 315-331)
const handleOpenMinuteModal = (sectorName, date, stocks) => {
  setMinuteModalData({ sectorName, date, stocks });
  setMinuteModalPage(0);
  setShowMinuteModal(true);
};

const closeMinuteModal = () => {
  setShowMinuteModal(false);
  setMinuteModalData(null);
  setMinuteModalPage(0);
};
```

#### ä»£ç ä¿®æ”¹ä½ç½®
- **src/app/page.tsx**:
  - lines 52-55: çŠ¶æ€å˜é‡
  - lines 315-331: å¤„ç†å‡½æ•°
  - lines 553-565: æ¿å—è¯¦æƒ…å¼¹çª—æŒ‰é’®
  - lines 1031-1045: æ¶¨åœæ•°å¼¹çª—æŒ‰é’®
  - lines 1466-1524: å•è‚¡åˆ†å±å¼¹çª—
  - lines 1591-1680: ç‹¬ç«‹åˆ†æ—¶å›¾å¼¹çª—

#### Z-indexå±‚çº§ä½“ç³»
```
z-40:  å¼¹çª—èƒŒæ™¯å±‚
z-50:  æ™®é€šå¼¹çª—
z-[60]: æ—¥æœŸåˆ—è¯¦æƒ…å¼¹çª—
z-[70]: å•è‚¡åˆ†æ—¶+Kçº¿å¼¹çª—
z-[80]: ç‹¬ç«‹Kçº¿æ‰¹é‡å¼¹çª—
z-[90]: ç‹¬ç«‹åˆ†æ—¶å›¾æ‰¹é‡å¼¹çª— â­ (æœ€é«˜å±‚)
```

### APIæ¥å£

#### åˆ†æ—¶å›¾API (æ–°å¢)
```
http://image.sinajs.cn/newchart/min/n/{sh/sz}code.gif

ç¤ºä¾‹:
- æ²ªå¸‚: http://image.sinajs.cn/newchart/min/n/sh600000.gif
- æ·±å¸‚: http://image.sinajs.cn/newchart/min/n/sz000001.gif
```

**å…³é”®å·®å¼‚**: åˆ†æ—¶å›¾APIè·¯å¾„ä¸­åŒ…å« `/n/` ç›®å½•

#### Kçº¿å›¾API (å·²æœ‰)
```
http://image.sinajs.cn/newchart/daily/{sh/sz}code.gif

ç¤ºä¾‹:
- æ²ªå¸‚: http://image.sinajs.cn/newchart/daily/sh600000.gif
- æ·±å¸‚: http://image.sinajs.cn/newchart/daily/sz000001.gif
```

---

## å¤‡ä»½å†…å®¹

### æœ¬åœ°å¤‡ä»½æ–‡ä»¶
- **æ–‡ä»¶å**: v4.8.14-minute-chart-20251013.tar.gz
- **ä½ç½®**: backup/ ç›®å½•
- **åŒ…å«å†…å®¹**:
  - âœ… æ‰€æœ‰æºä»£ç  (src/, public/, ç­‰)
  - âœ… é…ç½®æ–‡ä»¶ (package.json, tsconfig.json, tailwind.config.js, ç­‰)
  - âœ… Dockeré…ç½® (Dockerfile, docker-compose.yml)
  - âœ… éƒ¨ç½²æ–‡æ¡£ (DEPLOY-v4.8.14.txt)
  - âœ… å¤‡ä»½è¯´æ˜ (æœ¬æ–‡ä»¶)
  - âœ… CLAUDE.mdé…ç½®æ–‡ä»¶
- **æ’é™¤å†…å®¹**:
  - âŒ node_modules (ä¾èµ–åŒ…)
  - âŒ .next (æ„å»ºç¼“å­˜)
  - âŒ .git (Gitä»“åº“)
  - âŒ backup (å…¶ä»–å¤‡ä»½æ–‡ä»¶)
  - âŒ log/*.log (è¿è¡Œæ—¥å¿—)

### Gitæ ‡ç­¾
- **æ ‡ç­¾å**: v4.8.14-minute-chart-20251013
- **Commit**: f791f50
- **GitHub**: https://github.com/yushuo1991/911.git
- **æŸ¥çœ‹å‘½ä»¤**: `git show v4.8.14-minute-chart-20251013`

---

## æ¢å¤å¤‡ä»½

### æ–¹å¼1: ä»æœ¬åœ°tar.gzæ¢å¤

#### æ­¥éª¤1: è§£å‹å¤‡ä»½æ–‡ä»¶
```bash
# Windows (Git Bash)
cd "C:\Users\yushu\Desktop"
mkdir stock-tracker-v4.8.14
tar -xzf "stock-tracker - å‰¯æœ¬/backup/v4.8.14-minute-chart-20251013.tar.gz" -C stock-tracker-v4.8.14

# Linux/macOS
cd /www/wwwroot
mkdir stock-tracker-v4.8.14
tar -xzf /path/to/v4.8.14-minute-chart-20251013.tar.gz -C stock-tracker-v4.8.14
```

#### æ­¥éª¤2: å®‰è£…ä¾èµ–
```bash
cd stock-tracker-v4.8.14
npm install
```

#### æ­¥éª¤3: é…ç½®ç¯å¢ƒå˜é‡
```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘.envæ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“è¿æ¥ç­‰
vim .env
```

#### æ­¥éª¤4: å¯åŠ¨æœåŠ¡
```bash
# å¼€å‘ç¯å¢ƒ
npm run dev

# ç”Ÿäº§ç¯å¢ƒ (Docker)
docker compose build --no-cache
docker compose up -d
```

---

### æ–¹å¼2: ä»Gitæ ‡ç­¾æ¢å¤

#### æ­¥éª¤1: å…‹éš†ä»“åº“å¹¶æ£€å‡ºæ ‡ç­¾
```bash
# å…‹éš†ä»“åº“
git clone https://github.com/yushuo1991/911.git stock-tracker-v4.8.14
cd stock-tracker-v4.8.14

# æ£€å‡ºv4.8.14æ ‡ç­¾
git checkout v4.8.14-minute-chart-20251013
```

#### æ­¥éª¤2: å®‰è£…ä¾èµ–
```bash
npm install
```

#### æ­¥éª¤3: é…ç½®ç¯å¢ƒå˜é‡
```bash
cp .env.example .env
vim .env
```

#### æ­¥éª¤4: å¯åŠ¨æœåŠ¡
```bash
# ç”Ÿäº§ç¯å¢ƒ (Docker)
docker compose build --no-cache
docker compose up -d
```

---

### æ–¹å¼3: æœåŠ¡å™¨ç›´æ¥éƒ¨ç½²

å¦‚æœæœåŠ¡å™¨å·²æœ‰é¡¹ç›®ï¼Œåªéœ€åˆ‡æ¢åˆ°v4.8.14æ ‡ç­¾:

```bash
cd /www/wwwroot/stock-tracker

# æ‹‰å–æœ€æ–°æ ‡ç­¾
git fetch origin --tags

# æ£€å‡ºv4.8.14æ ‡ç­¾
git checkout v4.8.14-minute-chart-20251013

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker compose down
docker compose build --no-cache
docker compose up -d

# ç­‰å¾…å¯åŠ¨
sleep 30

# éªŒè¯
docker ps | grep stock-tracker
curl -I http://localhost:3002/api/stocks?date=$(date +%Y-%m-%d)&mode=7days
```

---

## åŠŸèƒ½éªŒè¯

### éªŒè¯æ¸…å•

#### 1. æ¿å—è¯¦æƒ…å¼¹çª—åˆ†æ—¶æŒ‰é’®
- [ ] ç‚¹å‡»ä»»æ„æ¿å—åç§°æ‰“å¼€æ¿å—è¯¦æƒ…å¼¹çª—
- [ ] å³ä¸Šè§’çœ‹åˆ°"ğŸ“Š ä»Šæ—¥åˆ†æ—¶"æŒ‰é’®(ç»¿è‰²)
- [ ] æŒ‰é’®ä½äº"æ˜¾ç¤ºKçº¿"æŒ‰é’®å·¦ä¾§
- [ ] ç‚¹å‡»æŒ‰é’®æ‰“å¼€ç‹¬ç«‹åˆ†æ—¶å›¾å¼¹çª—

#### 2. æ¶¨åœæ•°å¼¹çª—åˆ†æ—¶æŒ‰é’®
- [ ] ç‚¹å‡»ä»»æ„æ—¥æœŸçš„"XX åªæ¶¨åœ"
- [ ] æ¯ä¸ªæ¿å—æ ‡é¢˜å³ä¾§çœ‹åˆ°"ğŸ“ŠM"æŒ‰é’®(æµ…ç»¿è‰²)
- [ ] æŒ‰é’®ä½äº"ğŸ“ˆK"æŒ‰é’®å·¦ä¾§
- [ ] ç‚¹å‡»æŒ‰é’®æ‰“å¼€ç‹¬ç«‹åˆ†æ—¶å›¾å¼¹çª—

#### 3. ç‹¬ç«‹åˆ†æ—¶å›¾å¼¹çª—
- [ ] å¼¹çª—å æ®98vw Ã— 95vh(å‡ ä¹å…¨å±)
- [ ] åˆ†æ—¶å›¾ä»¥3-4åˆ—ç½‘æ ¼æ˜¾ç¤º
- [ ] æ¯é¡µæ˜¾ç¤º12åªä¸ªè‚¡
- [ ] åˆ†é¡µæ§åˆ¶æ­£å¸¸(ä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µ)
- [ ] åˆ†æ—¶å›¾åŠ è½½æ­£å¸¸(æ–°æµªè´¢ç»API)
- [ ] åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºç°è‰²å ä½å›¾
- [ ] å¼¹çª—èƒŒæ™¯ä¸ºé»‘è‰²åŠé€æ˜(bg-opacity-80)
- [ ] æ ‡é¢˜æ˜¾ç¤ºæ¿å—åç§°å’Œæ—¥æœŸ
- [ ] å…³é—­æŒ‰é’®(âœ•)æ­£å¸¸å·¥ä½œ

#### 4. å•è‚¡åˆ†æ—¶+Kçº¿åˆ†å±å¼¹çª—
- [ ] ç‚¹å‡»ä»»æ„è‚¡ç¥¨åç§°
- [ ] å¼¹çª—æ ‡é¢˜ä¸º"{è‚¡ç¥¨åç§°} ({ä»£ç }) ä»Šæ—¥åˆ†æ—¶ & Kçº¿å›¾"
- [ ] å·¦ä¾§50%æ˜¾ç¤ºåˆ†æ—¶å›¾(ç»¿è‰²å¾½ç«  "ğŸ“Š ä»Šæ—¥åˆ†æ—¶")
- [ ] å³ä¾§50%æ˜¾ç¤ºKçº¿å›¾(è“è‰²å¾½ç«  "ğŸ“ˆ æ—¥Kçº¿å›¾")
- [ ] ä¸­é—´æœ‰ç«–çº¿åˆ†éš”(border-r)
- [ ] ä¸¤å¼ å›¾ç‰‡å‡æ¸…æ™°æ˜¾ç¤º
- [ ] åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºå ä½å›¾

#### 5. è§†è§‰ä¸€è‡´æ€§
- [ ] åˆ†æ—¶å›¾æŒ‰é’®å‡ä¸ºç»¿è‰²ç³»(bg-green-600, bg-green-100)
- [ ] Kçº¿å›¾æŒ‰é’®å‡ä¸ºè“è‰²ç³»(bg-blue-600, bg-blue-100)
- [ ] æŒ‰é’®ä½ç½®ç»Ÿä¸€(åˆ†æ—¶åœ¨å·¦ï¼ŒKçº¿åœ¨å³)
- [ ] å­—ä½“å¤§å°å’Œæ ·å¼ä¸€è‡´

---

## æ€§èƒ½æŒ‡æ ‡

### é¢„æœŸæ€§èƒ½
- **å¼¹çª—æ‰“å¼€é€Ÿåº¦**: <500ms
- **å›¾ç‰‡åŠ è½½**: æ‡’åŠ è½½(loading="lazy")
- **åˆ†é¡µåˆ‡æ¢**: <100ms (æ— ç½‘ç»œè¯·æ±‚)
- **APIå“åº”**: <2s (å–å†³äºæ–°æµªè´¢ç»API)

### èµ„æºå ç”¨
- **å¤‡ä»½æ–‡ä»¶å¤§å°**: ~1-2MB (å‹ç¼©å)
- **Dockeré•œåƒ**: ~700MB
- **å†…å­˜å ç”¨**: åº”ç”¨å®¹å™¨ ~200MB, MySQLå®¹å™¨ ~300MB

---

## ç‰ˆæœ¬å¯¹æ¯”

### v4.8.14 vs v4.8.13

| åŠŸèƒ½ | v4.8.13 | v4.8.14 |
|------|---------|---------|
| ç‹¬ç«‹Kçº¿æ‰¹é‡å¼¹çª— | âœ… | âœ… |
| **ç‹¬ç«‹åˆ†æ—¶å›¾æ‰¹é‡å¼¹çª—** | âŒ | âœ… (æ–°å¢) |
| **æ¿å—è¯¦æƒ…åˆ†æ—¶æŒ‰é’®** | âŒ | âœ… (æ–°å¢) |
| **æ¶¨åœæ•°å¼¹çª—åˆ†æ—¶æŒ‰é’®** | âŒ | âœ… (æ–°å¢) |
| å•è‚¡Kçº¿æ˜¾ç¤º | âœ… | âœ… |
| **å•è‚¡åˆ†æ—¶+Kçº¿åˆ†å±** | âŒ | âœ… (æ–°å¢) |
| å…¨å±€æ’åºæ§åˆ¶ | âœ… | âœ… |
| Kçº¿æ’åºä¸€è‡´æ€§ | âœ… | âœ… |
| 7å¤©æ¿å—èŠ‚å¥ | âœ… | âœ… |
| æ¿å—æº¢ä»·è¿½è¸ª | âœ… | âœ… |

### æ–°å¢ä»·å€¼
1. **å¤šç»´åº¦åˆ†æ**: åˆ†æ—¶å›¾+Kçº¿å›¾åŒæ—¶æŸ¥çœ‹ï¼Œå…¨é¢äº†è§£ä¸ªè‚¡èµ°åŠ¿
2. **æ‰¹é‡å¯¹æ¯”**: ç‹¬ç«‹åˆ†æ—¶å›¾å¼¹çª—å¿«é€Ÿæµè§ˆæ¿å—å†…æ‰€æœ‰ä¸ªè‚¡å½“æ—¥åˆ†æ—¶
3. **æ“ä½œä¾¿æ·**: åˆ†æ—¶æŒ‰é’®ç´§é‚»Kçº¿æŒ‰é’®ï¼Œæ“ä½œé€»è¾‘ä¸€è‡´
4. **è§†è§‰åŒºåˆ†**: ç»¿è‰²åˆ†æ—¶ vs è“è‰²Kçº¿ï¼Œæ¸…æ™°åŒºåˆ†

---

## ä¾èµ–ç‰ˆæœ¬

### æ ¸å¿ƒä¾èµ–
- **Next.js**: 14.2.5
- **React**: 18.3.1
- **TypeScript**: 5.5.4
- **Tailwind CSS**: 3.4.7
- **Recharts**: 2.12.7

### è¿è¡Œç¯å¢ƒ
- **Node.js**: 18.17.0+
- **Docker**: 20.10+
- **Docker Compose**: 2.0+

---

## å·²çŸ¥é—®é¢˜

### æ— å·²çŸ¥é—®é¢˜
å½“å‰ç‰ˆæœ¬è¿è¡Œç¨³å®šï¼Œæ— å·²çŸ¥BUGã€‚

### æ³¨æ„äº‹é¡¹
1. **APIä¾èµ–**: åˆ†æ—¶å›¾ä¾èµ–æ–°æµªè´¢ç»APIï¼Œå¦‚APIä¸å¯ç”¨ä¼šæ˜¾ç¤ºå ä½å›¾
2. **ç½‘ç»œé€Ÿåº¦**: åˆ†æ—¶å›¾åŠ è½½é€Ÿåº¦å–å†³äºç½‘ç»œç¯å¢ƒå’Œæ–°æµªAPIå“åº”é€Ÿåº¦
3. **æµè§ˆå™¨å…¼å®¹**: å·²åœ¨Chromeã€Firefoxã€Edgeæµ‹è¯•é€šè¿‡ï¼ŒIEä¸æ”¯æŒ
4. **ç¼“å­˜æ¸…ç†**: éƒ¨ç½²åå»ºè®®ç”¨æˆ·å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨(Ctrl+Shift+R)

---

## å›æ»šæ–¹æ¡ˆ

### å›æ»šåˆ°v4.8.13 (Kçº¿æ’åºä¸€è‡´æ€§)
```bash
cd /www/wwwroot/stock-tracker
git checkout v4.8.13
docker compose down
docker compose build --no-cache
docker compose up -d
```

### å›æ»šåˆ°v4.8.12 (ç‹¬ç«‹Kçº¿å¼¹çª—)
```bash
cd /www/wwwroot/stock-tracker
git checkout 7333eee
docker compose down
docker compose build --no-cache
docker compose up -d
```

---

## ç›¸å…³æ–‡æ¡£

- **éƒ¨ç½²æŒ‡å—**: DEPLOY-v4.8.14.txt
- **v4.8.13éƒ¨ç½²**: DEPLOY-v4.8.13.txt
- **v4.8.12éƒ¨ç½²**: DEPLOY-v4.8.12.txt
- **502é”™è¯¯è¯Šæ–­**: log/502-ERROR-REPORT-20251013.md
- **ä¿®å¤è„šæœ¬**: server-fix-502.sh

---

## æŠ€æœ¯æ”¯æŒ

### å¸¸è§é—®é¢˜
å‚è€ƒ `DEPLOY-v4.8.14.txt` ä¸­çš„å¸¸è§é—®é¢˜ç« èŠ‚

### æ•…éšœæ’æŸ¥
1. æ£€æŸ¥Dockerå®¹å™¨çŠ¶æ€: `docker ps`
2. æŸ¥çœ‹åº”ç”¨æ—¥å¿—: `docker logs stock-tracker-app`
3. æµ‹è¯•API: `curl http://localhost:3002/api/stocks?date=2025-10-13&mode=7days`
4. éªŒè¯Nginx: `nginx -t && systemctl status nginx`

### è”ç³»æ–¹å¼
- **GitHub**: https://github.com/yushuo1991/911
- **Issues**: https://github.com/yushuo1991/911/issues

---

**å¤‡ä»½åˆ›å»º**: 2025-10-13
**å¤‡ä»½ç‰ˆæœ¬**: v4.8.14-minute-chart-20251013
**Commit**: f791f50
**åŠŸèƒ½**: åˆ†æ—¶å›¾æ‰¹é‡å±•ç¤º + å•è‚¡åˆ†æ—¶+Kçº¿åˆ†å±
**çŠ¶æ€**: âœ… ç¨³å®šç‰ˆæœ¬ï¼Œæ¨èä½¿ç”¨
**ä½œè€…**: Claude Code
