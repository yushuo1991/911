╔═══════════════════════════════════════════════════════════════════════════╗
║                    Nginx 502 修复 - 快速参考卡                            ║
║                         Quick Fix Guide                                   ║
╚═══════════════════════════════════════════════════════════════════════════╝

【问题】
  外部访问 http://bk.yushuo.click 返回 "502 Bad Gateway"
  Docker容器运行正常，本地访问OK，但Nginx配置缺失

【最快解决方案 - 宝塔面板】(推荐⭐⭐⭐⭐⭐)

  1️⃣ 打开浏览器访问宝塔面板
     通常: http://yushuo.click:8888

  2️⃣ 登录后，左侧菜单 → 网站

  3️⃣ 找到 bk.yushuo.click，点击"设置"

  4️⃣ 点击"配置文件"选项卡

  5️⃣ 替换为以下配置（全选删除，粘贴新配置）:

┌───────────────────────────────────────────────────────────────────┐
│ server {                                                          │
│     listen 80;                                                    │
│     server_name bk.yushuo.click;                                  │
│                                                                   │
│     location / {                                                  │
│         proxy_pass http://localhost:3002;                         │
│         proxy_http_version 1.1;                                   │
│         proxy_set_header Upgrade $http_upgrade;                   │
│         proxy_set_header Connection 'upgrade';                    │
│         proxy_set_header Host $host;                              │
│         proxy_cache_bypass $http_upgrade;                         │
│         proxy_set_header X-Real-IP $remote_addr;                  │
│         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; │
│         proxy_set_header X-Forwarded-Proto $scheme;               │
│         proxy_connect_timeout 60s;                                │
│         proxy_send_timeout 60s;                                   │
│         proxy_read_timeout 60s;                                   │
│     }                                                             │
│                                                                   │
│     access_log /www/wwwlogs/bk.yushuo.click.log;                 │
│     error_log /www/wwwlogs/bk.yushuo.click.error.log;            │
│ }                                                                 │
└───────────────────────────────────────────────────────────────────┘

  6️⃣ 点击"保存"按钮

  7️⃣ 左侧菜单 → 软件商店 → 找到Nginx → 点击"重载配置"

  8️⃣ 浏览器访问 http://bk.yushuo.click 验证

═══════════════════════════════════════════════════════════════════════

【备选方案1 - 宝塔终端】

  1️⃣ 宝塔面板 → 终端

  2️⃣ 执行以下命令:
     cd /www/wwwroot/stock-tracker
     chmod +x fix-nginx-502.sh
     ./fix-nginx-502.sh

  3️⃣ 等待脚本执行完成，查看输出

═══════════════════════════════════════════════════════════════════════

【备选方案2 - PuTTY】

  1️⃣ 下载 PuTTY: https://www.putty.org/

  2️⃣ 打开PuTTY，输入:
     Host Name: yushuo.click (或 75.2.60.5)
     Port: 22

  3️⃣ 点击 Open

  4️⃣ 登录:
     login as: root
     password: gJ75hNHdy90TA4qGo9

  5️⃣ 执行:
     cd /www/wwwroot/stock-tracker
     ./fix-nginx-502.sh

═══════════════════════════════════════════════════════════════════════

【验证成功】✅

  □ nginx -t 显示 "syntax is ok"
  □ systemctl status nginx 显示 "active (running)"
  □ curl -I http://bk.yushuo.click 返回 "HTTP/1.1 200 OK"
  □ 浏览器访问显示应用

═══════════════════════════════════════════════════════════════════════

【如果还有问题】🔧

  在服务器上执行诊断:

  # 检查Docker
  docker ps | grep stock-tracker

  # 检查端口
  netstat -tlnp | grep -E '(:80|:3002)'

  # 查看错误日志
  tail -50 /www/wwwlogs/bk.yushuo.click.error.log

  # 测试本地访问
  curl -v http://localhost:3002

═══════════════════════════════════════════════════════════════════════

【服务器信息】📋

  Host:     yushuo.click (75.2.60.5)
  Port:     22
  User:     root
  Password: gJ75hNHdy90TA4qGo9
  Project:  /www/wwwroot/stock-tracker
  App Port: 3002
  Domain:   bk.yushuo.click

═══════════════════════════════════════════════════════════════════════

【生成的文件】📁

  fix-nginx-502.sh                          - 自动修复脚本
  ssh-connect.ps1                           - SSH连接工具
  NGINX_FIX_SUMMARY.md                      - 完整摘要
  log/nginx-502-fix-guide-20250930.md       - 详细指南
  QUICK_FIX_GUIDE.txt                       - 本快速参考

═══════════════════════════════════════════════════════════════════════

生成时间: 2025-09-30
问题: 502 Bad Gateway
原因: Nginx配置缺失
影响: 外部无法访问应用
解决: 创建正确的Nginx反向代理配置

╚═══════════════════════════════════════════════════════════════════════╝