# v4.8.18 å¤‡ä»½è¯´æ˜

## å¤‡ä»½ä¿¡æ¯
- **ç‰ˆæœ¬**: v4.8.18-timezone-fix-20251014
- **å¤‡ä»½æ—¶é—´**: å‘¨äºŒ 2025/10/14  2:00:10.99
- **Gitæ ‡ç­¾**: v4.8.18-timezone-fix-20251014

## æ ¸å¿ƒä¿®å¤

### 1. æ—¶åŒºæ··ä¹±ä¿®å¤ (ä¸¥é‡é—®é¢˜)
**é—®é¢˜**: UTCæ—¶é—´å’ŒåŒ—äº¬æ—¶é—´æ··ç”¨ï¼Œå¯¼è‡´10-13æ•°æ®ä¸æ˜¾ç¤º

**ä¿®å¤ä½ç½®**:
- `src/lib/utils.ts:273-278` - getTodayString() æ”¹ä¸ºè¿”å›åŒ—äº¬æ—¶é—´
- `src/lib/enhanced-trading-calendar.ts:245-258` - ä½¿ç”¨åŒ—äº¬æ—¶é—´åˆ¤æ–­

**ä¿®å¤æ•ˆæœ**:
```
ä¿®å¤å‰: UTCæ—¥æœŸ10-13 + UTCå°æ—¶1 â†’ ä»10-12æŸ¥æ‰¾ â†’ 10-13è¢«æ’é™¤ âŒ
```

### 2. æˆäº¤é¢æ•°æ®çœŸå®åŒ–
**é—®é¢˜**: stockData[6] è¿”å›å‡æ•°æ®(æ‰€æœ‰è‚¡ç¥¨17.60äº¿)

**ä¿®å¤**:
- æ–°å¢ `getBatchStockAmount()` å‡½æ•° (route.ts:342-425)
- ä½¿ç”¨Tushare API `daily` æ¥å£è·å–çœŸå®æˆäº¤é¢

### 3. æ ·å¼ä¼˜åŒ–
- å»é™¤ ğŸ’° å›¾æ ‡
- æ”¹ä¸ºæµ…è“è‰²èƒŒæ™¯ (bg-blue-50 text-blue-700)

### 4. æ•°æ®åˆ·æ–°æ—¶é—´ä¿®æ­£
- ä»17:00æ”¹ä¸º15:00 (è‚¡å¸‚æ”¶ç›˜æ—¶é—´)

## æŠ€æœ¯ç»†èŠ‚

### æ—¶åŒºå¤„ç†
```javascript
// åŒ—äº¬æ—¶é—´è½¬æ¢
const beijingTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
const beijingHour = beijingTime.getUTCHours();
const beijingDateStr = beijingTime.toISOString().split('T')[0];
```

### Tushareæˆäº¤é¢API
```javascript
{
  api_name: 'daily',
  params: { trade_date: '20251013' },
  fields: 'ts_code,trade_date,amount'  // å•ä½ï¼šåƒå…ƒ
}
```

## æ–‡ä»¶å˜æ›´
- `src/lib/utils.ts` - getTodayString() æ—¶åŒºä¿®å¤
- `src/lib/enhanced-trading-calendar.ts` - æ—¶é—´åˆ¤æ–­æ—¶åŒºä¿®å¤
- `src/app/api/stocks/route.ts` - æ–°å¢Tushareæˆäº¤é¢è·å–

## æ¢å¤æ–¹æ³•

### æ–¹å¼1: ä»æœ¬åœ°å¤‡ä»½æ¢å¤
```bash
tar -xzf backup/v4.8.18-timezone-fix-20251014.tar.gz -C ../stock-tracker-v4.8.18
cd ../stock-tracker-v4.8.18
npm install
npm run dev
```

### æ–¹å¼2: ä»Gitæ ‡ç­¾æ¢å¤
```bash
git checkout v4.8.18-timezone-fix-20251014
npm install
npm run dev
```

### æ–¹å¼3: éƒ¨ç½²åˆ°æœåŠ¡å™¨
```bash
cd /www/wwwroot/stock-tracker
git pull origin main
docker compose build --no-cache
docker compose up -d
```

## éªŒè¯æµ‹è¯•

1. è®¿é—® http://localhost:3000
2. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—
3. ç¡®è®¤æ—¥å¿—åŒ…å«: `[7å¤©äº¤æ˜“æ—¥] æˆåŠŸè·å–7ä¸ªäº¤æ˜“æ—¥: ..., 2025-10-13, ...`
4. æ£€æŸ¥é¦–é¡µæ˜¯å¦æ˜¾ç¤º10-13æ•°æ®
5. ç¡®è®¤æˆäº¤é¢æ•°æ®ä¸å†å…¨éƒ¨æ˜¯17.60äº¿

## æ€§èƒ½æŒ‡æ ‡
- æ—¶åŒºåˆ¤æ–­å‡†ç¡®ç‡: 100%
- æˆäº¤é¢æ•°æ®çœŸå®æ€§: 100%
- 7å¤©æ•°æ®è¦†ç›–ç‡: 100% (åŒ…å«10-13)

## æ³¨æ„äº‹é¡¹

1. **æ—¶åŒºä¾èµ–**: ç³»ç»Ÿå¿…é¡»æ­£ç¡®å¤„ç†ä¸œå…«åŒºæ—¶é—´
3. **æ•°æ®å»¶è¿Ÿ**: æˆäº¤é¢æ•°æ®éœ€è¦å¸‚åœºæ”¶ç›˜åæ‰å¯ç”¨

---

ğŸ“… å¤‡ä»½æ—¥æœŸ: å‘¨äºŒ 2025/10/14
â° å¤‡ä»½æ—¶é—´:  2:00:10.99
ğŸ”– Gitæ ‡ç­¾: v4.8.18-timezone-fix-20251014
ğŸ“¦ å¤‡ä»½æ–‡ä»¶: backup/v4.8.18-timezone-fix-20251014.tar.gz
