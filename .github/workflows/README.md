# GitHub Actions è‡ªåŠ¨éƒ¨ç½²é…ç½®è¯´æ˜

## ğŸ“‹ é…ç½®æ­¥éª¤

### 1. è®¾ç½® GitHub Secrets

åœ¨ä½ çš„ GitHub ä»“åº“ä¸­è®¾ç½®ä»¥ä¸‹ Secretsï¼š

1. è¿›å…¥ä»“åº“ â†’ **Settings** â†’ **Secrets and variables** â†’ **Actions**
2. ç‚¹å‡» **New repository secret**
3. æ·»åŠ ä»¥ä¸‹ä¸‰ä¸ª secretsï¼š

| Name | Value | è¯´æ˜ |
|------|-------|------|
| `SERVER_HOST` | `107.173.154.147` | æœåŠ¡å™¨IPåœ°å€ |
| `SERVER_USERNAME` | `root` | SSHç”¨æˆ·å |
| `SERVER_PASSWORD` | `gJ75hNHdy90TA4qGo9` | SSHå¯†ç  |

### 2. éªŒè¯é…ç½®

é…ç½®å®Œæˆåï¼ŒGitHub Actions ä¼šåœ¨ä»¥ä¸‹æƒ…å†µè‡ªåŠ¨è§¦å‘éƒ¨ç½²ï¼š

- âœ… æ¯æ¬¡ `push` ä»£ç åˆ° `main` åˆ†æ”¯
- âœ… æ‰‹åŠ¨è§¦å‘ï¼ˆActions â†’ Deploy to Server â†’ Run workflowï¼‰

### 3. æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—

1. è¿›å…¥ä»“åº“ â†’ **Actions** æ ‡ç­¾
2. ç‚¹å‡»æœ€æ–°çš„ workflow è¿è¡Œ
3. æŸ¥çœ‹è¯¦ç»†çš„éƒ¨ç½²æ—¥å¿—

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### è‡ªåŠ¨éƒ¨ç½²ï¼ˆæ¨èï¼‰

åªéœ€æ­£å¸¸æäº¤ä»£ç å³å¯ï¼š

```bash
git add .
git commit -m "ä½ çš„æäº¤ä¿¡æ¯"
git push origin main
```

GitHub Actions ä¼šè‡ªåŠ¨ï¼š
1. SSHè¿æ¥åˆ°æœåŠ¡å™¨
2. Gitæ‹‰å–æœ€æ–°ä»£ç 
3. å®‰è£…ä¾èµ–å’Œæ„å»ºé¡¹ç›®
4. é‡å¯PM2åº”ç”¨
5. éªŒè¯éƒ¨ç½²ç»“æœ

### æ‰‹åŠ¨è§¦å‘éƒ¨ç½²

å¦‚æœéœ€è¦æ‰‹åŠ¨è§¦å‘éƒ¨ç½²ï¼ˆä¸ä¿®æ”¹ä»£ç ï¼‰ï¼š

1. è¿›å…¥ GitHub ä»“åº“
2. ç‚¹å‡» **Actions** æ ‡ç­¾
3. é€‰æ‹© **Deploy to Server (PM2)**
4. ç‚¹å‡» **Run workflow** â†’ **Run workflow**

---

## ğŸ“Š éƒ¨ç½²æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Push to main   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GitHub Actions  â”‚
â”‚   è‡ªåŠ¨è§¦å‘      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SSHè¿æ¥æœåŠ¡å™¨   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Git Pull ä»£ç    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ npm install     â”‚
â”‚ npm run build   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PM2 é‡å¯åº”ç”¨    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… éƒ¨ç½²å®Œæˆ     â”‚
â”‚ http://bk.yushuo.click
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šéƒ¨ç½²å¤±è´¥ - SSHè¿æ¥è¶…æ—¶

**åŸå› **ï¼šæœåŠ¡å™¨é˜²ç«å¢™é˜»æ­¢GitHub Actionsçš„IP

**è§£å†³æ–¹æ³•**ï¼š
1. ç™»å½•æœåŠ¡å™¨
2. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™ï¼š`iptables -L`
3. æˆ–è€…ä½¿ç”¨å®å¡”é¢æ¿ â†’ å®‰å…¨ â†’ æ·»åŠ æ”¾è¡Œè§„åˆ™

### é—®é¢˜2ï¼šPM2å‘½ä»¤æœªæ‰¾åˆ°

**åŸå› **ï¼šPM2æœªå…¨å±€å®‰è£…æˆ–PATHæœªé…ç½®

**è§£å†³æ–¹æ³•**ï¼š
```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
npm install -g pm2
pm2 startup
pm2 save
```

### é—®é¢˜3ï¼šnpm install å¾ˆæ…¢

**è§£å†³æ–¹æ³•**ï¼šåœ¨æœåŠ¡å™¨ä¸Šé…ç½®æ·˜å®é•œåƒ
```bash
npm config set registry https://registry.npmmirror.com
```

---

## ğŸ¯ ä¼˜åŠ¿

ç›¸æ¯”æ‰‹åŠ¨éƒ¨ç½²ï¼ŒGitHub Actions çš„ä¼˜åŠ¿ï¼š

| åŠŸèƒ½ | æ‰‹åŠ¨éƒ¨ç½² | GitHub Actions |
|------|----------|----------------|
| è‡ªåŠ¨åŒ– | âŒ éœ€è¦è¿è¡Œå‘½ä»¤ | âœ… è‡ªåŠ¨è§¦å‘ |
| éƒ¨ç½²å†å² | âŒ æ— è®°å½• | âœ… å®Œæ•´æ—¥å¿— |
| å¤±è´¥é€šçŸ¥ | âŒ æ—  | âœ… é‚®ä»¶/é€šçŸ¥ |
| å›æ»š | âŒ æ‰‹åŠ¨æ“ä½œ | âœ… é‡æ–°è¿è¡Œæ—§ç‰ˆæœ¬ |
| æƒé™ç®¡ç† | âŒ æœ¬åœ°å¯†ç  | âœ… GitHubç®¡ç† |
| å¤šäººåä½œ | âŒ éœ€å…±äº«å¯†ç  | âœ… ç»Ÿä¸€é…ç½® |

---

## ğŸ“ é«˜çº§é…ç½®

### ä»…åœ¨ç‰¹å®šæ–‡ä»¶ä¿®æ”¹æ—¶éƒ¨ç½²

ä¿®æ”¹ `.github/workflows/deploy.yml`ï¼š

```yaml
on:
  push:
    branches: [ main ]
    paths:
      - 'src/**'
      - 'package.json'
      - 'next.config.js'
```

### æ·»åŠ éƒ¨ç½²é€šçŸ¥

å¯ä»¥é›†æˆä¼ä¸šå¾®ä¿¡ã€é’‰é’‰ç­‰é€šçŸ¥ï¼š

```yaml
- name: å‘é€é€šçŸ¥
  run: |
    curl 'https://your-webhook-url' \
      -H 'Content-Type: application/json' \
      -d '{"text":"âœ… éƒ¨ç½²æˆåŠŸï¼è®¿é—® http://bk.yushuo.click"}'
```

### æ·»åŠ ç¯å¢ƒå˜é‡

åœ¨ workflow ä¸­è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```yaml
env:
  NODE_ENV: production
  PORT: 3000
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [GitHub Actions å®˜æ–¹æ–‡æ¡£](https://docs.github.com/cn/actions)
- [appleboy/ssh-action](https://github.com/appleboy/ssh-action)
- [PM2 æ–‡æ¡£](https://pm2.keymetrics.io/docs/usage/quick-start/)

---

**é…ç½®å®Œæˆåï¼Œæ¯æ¬¡ push ä»£ç å³å¯è‡ªåŠ¨éƒ¨ç½²ï¼ğŸ‰**

