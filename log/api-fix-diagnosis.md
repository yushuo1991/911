# API调用问题诊断报告

## 问题描述
用户部署的股票追踪系统显示"暂无涨停数据"，API调用返回空结果。

## 排查过程

### 1. 问题定位
- **模块**: API路由处理 (`src/app/api/stocks/route.ts`)
- **症状**: API返回参数错误 (errcode: 1020, errmsg: "参数出错")
- **影响**: 前端无法获取股票数据，用户看到空白页面

### 2. 根本原因分析
通过本地测试脚本验证，发现API参数格式问题：

**错误的参数格式:**
```javascript
{
  date: '20240911',    // 小写date
  Index: '0',
  // ... 其他参数
}
```

**正确的参数格式:**
```javascript
{
  Date: '20240911',    // 大写Date
  Index: '0',
  // ... 其他参数
}
```

### 3. 数据结构差异
API返回的数据结构与预期不同：

**实际返回结构:**
```json
{
  "list": [
    {
      "ZSName": "锂电池",
      "StockList": [
        ["000546", "金圆股份", 0, "", 0, 0, 1726018770, 0, 55794232, "首板", ...]
      ]
    }
  ]
}
```

**之前预期结构:**
```json
{
  "PlateInfo": [
    {
      "PlateName": "板块名称",
      "PlateStockList": [...]
    }
  ]
}
```

## 解决方案

### 1. 修复API参数
- 将参数名从 `date` 改为 `Date` (大写D)
- 保持日期格式为 YYYYMMDD

### 2. 更新数据解析逻辑
- 解析 `list` 数组而不是 `PlateInfo`
- 从 `StockList` 数组中提取股票信息
- 数组索引含义：[0]=代码, [1]=名称, [9]=板位

### 3. 后端技术要点
- **Nginx**: 无问题，API请求能正常到达
- **Node.js/Next.js**: API路由参数解析问题
- **网络请求**: fetch请求正常，但参数格式错误

## 修复验证
需要部署更新后验证：
1. API能否正常返回数据
2. 前端能否正确显示股票列表
3. 日期切换功能是否正常

## 教训总结
1. API集成时要仔细验证参数格式，大小写敏感
2. 数据结构变化需要同步更新解析逻辑
3. 本地测试脚本是快速定位问题的有效工具