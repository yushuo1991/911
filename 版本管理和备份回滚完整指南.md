# è‚¡ç¥¨è¿½è¸ªç³»ç»Ÿ - ç‰ˆæœ¬ç®¡ç†å’Œå¤‡ä»½å›æ»šå®Œæ•´æŒ‡å—

## ğŸ“– ç›®å½•
- [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
- [å¤‡ä»½ç­–ç•¥](#å¤‡ä»½ç­–ç•¥)
- [æ—¥å¸¸æ“ä½œ](#æ—¥å¸¸æ“ä½œ)
- [å›æ»šæ“ä½œ](#å›æ»šæ“ä½œ)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [æ•…éšœå¤„ç†](#æ•…éšœå¤„ç†)
- [ç»´æŠ¤å»ºè®®](#ç»´æŠ¤å»ºè®®)

---

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

### é¡¹ç›®ä¿¡æ¯
- **é¡¹ç›®åç§°**: è‚¡ç¥¨è¿½è¸ªç³»ç»Ÿ
- **åŸŸåè®¿é—®**: https://bk.yushuo.click
- **æœåŠ¡å™¨IP**: 107.173.154.147
- **éƒ¨ç½²æ–¹å¼**: Dockerå®¹å™¨åŒ–éƒ¨ç½²
- **ä»£ç ä»“åº“**: https://github.com/yushuo1991/911.git

### æŠ€æœ¯æ¶æ„
```
è‚¡ç¥¨è¿½è¸ªç³»ç»Ÿ
â”œâ”€â”€ å‰ç«¯: Next.js + React + TailwindCSS
â”œâ”€â”€ åç«¯: Next.js API Routes
â”œâ”€â”€ æ•°æ®æº: Tushare API
â”œâ”€â”€ éƒ¨ç½²: Docker + å®å¡”é¢æ¿
â””â”€â”€ åŸŸå: bk.yushuo.click (åå‘ä»£ç†)
```

---

## ğŸ“¦ å¤‡ä»½ç­–ç•¥

### ä¸‰é‡å¤‡ä»½ä½“ç³»

| å¤‡ä»½ç±»å‹ | å†…å®¹ | ä¼˜åŠ¿ | ç”¨é€” |
|---------|------|------|------|
| **æœ¬åœ°å¤‡ä»½** | ä»£ç +ç¯å¢ƒ+é…ç½®+é•œåƒ | æœ€å¿«æ¢å¤(30ç§’) | æ—¥å¸¸å¿«é€Ÿå›æ»š |
| **Dockerå¤‡ä»½** | å®Œæ•´è¿è¡Œç¯å¢ƒ | ç¯å¢ƒä¸€è‡´æ€§ | è·¨æœåŠ¡å™¨è¿ç§» |
| **GitHubå¤‡ä»½** | ä»£ç +é…ç½®+ç‰ˆæœ¬å†å² | äº‘ç«¯å®‰å…¨å­˜å‚¨ | è¿œç¨‹åä½œ&ç¾éš¾æ¢å¤ |

### å¤‡ä»½å†…å®¹è¯¦æƒ…

#### æœ¬åœ°å¤‡ä»½ (`./backups/`)
```
backups/v1.0.0-20250923-120000/
â”œâ”€â”€ code/                    # å®Œæ•´ä»£ç å¿«ç…§
â”œâ”€â”€ docker-image.tar         # Dockeré•œåƒæ–‡ä»¶(~720MB)
â”œâ”€â”€ environment-info.txt     # ç¯å¢ƒä¿¡æ¯è®°å½•
â””â”€â”€ restore.sh              # ä¸€é”®è¿˜åŸè„šæœ¬
```

#### Dockerå¤‡ä»½
```bash
# é•œåƒç‰ˆæœ¬æ ‡ç­¾
stock-tracker:latest         # å½“å‰è¿è¡Œç‰ˆæœ¬
stock-tracker:v1.0.0        # ç‰ˆæœ¬åŒ–é•œåƒ
stock-tracker:v1.1.0        # å„ä¸ªå†å²ç‰ˆæœ¬...
```

#### GitHubå¤‡ä»½
```bash
# Gitæ ‡ç­¾å¯¹åº”ç‰ˆæœ¬
v1.0.0, v1.1.0, v2.0.0...   # ä»£ç ç‰ˆæœ¬æ ‡ç­¾
mainåˆ†æ”¯                      # æœ€æ–°ä»£ç 
```

---

## ğŸš€ æ—¥å¸¸æ“ä½œ

### ç‰ˆæœ¬ç®¡ç†è„šæœ¬

**æ ¸å¿ƒå‘½ä»¤**: `./version-manager.sh`

#### 1. æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
```bash
# æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
./version-manager.sh version

# æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬
./version-manager.sh list

# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
./version-manager.sh
```

#### 2. åˆ›å»ºæ–°ç‰ˆæœ¬å¤‡ä»½

**è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶**:
- **patch** (è¡¥ä¸): 1.0.0 â†’ 1.0.1 (bugä¿®å¤)
- **minor** (å°ç‰ˆæœ¬): 1.0.0 â†’ 1.1.0 (æ–°åŠŸèƒ½)
- **major** (å¤§ç‰ˆæœ¬): 1.0.0 â†’ 2.0.0 (é‡å¤§æ”¹åŠ¨)

```bash
# Bugä¿®å¤ (1.0.0 â†’ 1.0.1)
./version-manager.sh backup patch "ä¿®å¤è‚¡ç¥¨æ•°æ®æ˜¾ç¤ºé—®é¢˜"

# æ–°åŠŸèƒ½ (1.0.0 â†’ 1.1.0)
./version-manager.sh backup minor "æ·»åŠ Kçº¿å›¾åŠŸèƒ½"

# é‡å¤§æ›´æ–° (1.0.0 â†’ 2.0.0)
./version-manager.sh backup major "é‡æ„æ•°æ®å¤„ç†æ¶æ„"
```

### å¼€å‘å·¥ä½œæµç¨‹

#### æ ‡å‡†å¼€å‘æµç¨‹
```bash
# 1. å¼€å‘å‰å¤‡ä»½å½“å‰ç¨³å®šç‰ˆæœ¬
./version-manager.sh backup patch "å¼€å‘å‰å¤‡ä»½"

# 2. è¿›è¡Œä»£ç å¼€å‘å’Œä¿®æ”¹
# ... ä¿®æ”¹ä»£ç  ...

# 3. æœ¬åœ°æµ‹è¯•
npm run build     # æµ‹è¯•æ„å»º
./deploy.sh       # æµ‹è¯•éƒ¨ç½²

# 4. è®¿é—®æµ‹è¯•
curl http://127.0.0.1:3000  # æœ¬åœ°æµ‹è¯•
# è®¿é—® https://bk.yushuo.click # çº¿ä¸Šæµ‹è¯•

# 5. åŠŸèƒ½ç¡®è®¤æ— è¯¯ååˆ›å»ºç‰ˆæœ¬
./version-manager.sh backup minor "æ–°åŠŸèƒ½å¼€å‘å®Œæˆ"
```

#### å¿«é€Ÿä¿®å¤æµç¨‹
```bash
# 1. å‘ç°é—®é¢˜ï¼Œç«‹å³å›æ»š
./version-manager.sh restore v1.0.0

# 2. ä¿®å¤é—®é¢˜
# ... ä¿®æ”¹ä»£ç  ...

# 3. å¿«é€Ÿéƒ¨ç½²æµ‹è¯•
./deploy.sh

# 4. ç¡®è®¤ä¿®å¤ååˆ›å»ºè¡¥ä¸ç‰ˆæœ¬
./version-manager.sh backup patch "ç´§æ€¥ä¿®å¤ç”Ÿäº§é—®é¢˜"
```

---

## ğŸ”„ å›æ»šæ“ä½œ

### å›æ»šç­–ç•¥é€‰æ‹©

#### 1. å¿«é€Ÿå›æ»š (æ¨èï¼Œ30ç§’å®Œæˆ)
```bash
# ä¸€é”®å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
./version-manager.sh restore v1.0.0

# è‡ªåŠ¨æ‰§è¡Œï¼š
# - åœæ­¢å½“å‰å®¹å™¨
# - æ¢å¤ä»£ç æ–‡ä»¶
# - åŠ è½½å¯¹åº”Dockeré•œåƒ
# - å¯åŠ¨æ–°å®¹å™¨
# - éªŒè¯æœåŠ¡çŠ¶æ€
```

#### 2. Dockeré•œåƒå›æ»š (2åˆ†é’Ÿå®Œæˆ)
```bash
# æ‰‹åŠ¨ä½¿ç”¨Dockeré•œåƒå›æ»š
docker stop stock-tracker-app
docker rm stock-tracker-app
docker run -d --name stock-tracker-app -p 3000:3000 stock-tracker:v1.0.0
```

#### 3. ä»GitHubé‡å»º (10åˆ†é’Ÿå®Œæˆ)
```bash
# å®Œå…¨é‡æ–°éƒ¨ç½²ï¼ˆç¾éš¾æ¢å¤ï¼‰
git checkout v1.0.0
./deploy.sh
```

### å›æ»šéªŒè¯æ£€æŸ¥

æ¯æ¬¡å›æ»šåå¿…é¡»éªŒè¯ï¼š
```bash
# 1. æ£€æŸ¥ç‰ˆæœ¬å·
cat VERSION

# 2. æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps | grep stock-tracker-app

# 3. æ£€æŸ¥æœåŠ¡å“åº”
curl -I http://127.0.0.1:3000

# 4. æ£€æŸ¥ç½‘ç«™è®¿é—®
# æµè§ˆå™¨è®¿é—®: https://bk.yushuo.click

# 5. æ£€æŸ¥æ ¸å¿ƒåŠŸèƒ½
# - è‚¡ç¥¨æ•°æ®åŠ è½½
# - æ—¥æœŸé€‰æ‹©åŠŸèƒ½
# - Kçº¿å›¾å¼¹çª—
# - æ¿å—åˆ†æå›¾è¡¨
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### å¤‡ä»½æ—¶æœºå»ºè®®

#### å¿…é¡»å¤‡ä»½çš„æ—¶æœº
- âœ… **åŠŸèƒ½å¼€å‘å®Œæˆ** - æ–°åŠŸèƒ½ç¨³å®šè¿è¡Œå
- âœ… **Bugä¿®å¤å®Œæˆ** - é—®é¢˜è§£å†³å¹¶éªŒè¯å
- âœ… **ç‰ˆæœ¬å‘å¸ƒå‰** - é‡è¦æ›´æ–°éƒ¨ç½²å‰
- âœ… **ç³»ç»Ÿé…ç½®å˜æ›´** - ç¯å¢ƒé…ç½®ä¿®æ”¹å
- âœ… **å®šæœŸå¤‡ä»½** - æ¯å‘¨è‡³å°‘ä¸€æ¬¡ç¨³å®šç‰ˆæœ¬

#### å»ºè®®å¤‡ä»½çš„æ—¶æœº
- ğŸ”¶ **å¤§é‡ä»£ç ä¿®æ”¹å‰** - ä½œä¸ºå®‰å…¨å¤‡ä»½
- ğŸ”¶ **å®éªŒæ€§åŠŸèƒ½å¼€å‘å‰** - æ–¹ä¾¿å¿«é€Ÿå›æ»š
- ğŸ”¶ **æœåŠ¡å™¨ç»´æŠ¤å‰** - é¢„é˜²æ„å¤–æƒ…å†µ
- ğŸ”¶ **ç¬¬ä¸‰æ–¹ä¾èµ–æ›´æ–°å** - ç¡®ä¿å…¼å®¹æ€§

### ç‰ˆæœ¬å‘½åè§„èŒƒ

#### æè¿°ä¿¡æ¯æ ¼å¼
```bash
# æ ¼å¼ï¼š[ç±»å‹] ç®€çŸ­æè¿° - è¯¦ç»†è¯´æ˜
./version-manager.sh backup patch "ğŸ› ä¿®å¤APIè¶…æ—¶é—®é¢˜ - å¢åŠ é‡è¯•æœºåˆ¶å’Œé”™è¯¯å¤„ç†"
./version-manager.sh backup minor "âœ¨ æ–°å¢æ•°æ®å¯¼å‡ºåŠŸèƒ½ - æ”¯æŒExcelå’ŒCSVæ ¼å¼å¯¼å‡º"
./version-manager.sh backup major "ğŸš€ å‡çº§åˆ°Next.js 15 - é‡æ„æ•´ä½“æ¶æ„æå‡æ€§èƒ½"
```

#### å¸¸ç”¨emojiå‰ç¼€
- ğŸ› Bugä¿®å¤
- âœ¨ æ–°åŠŸèƒ½
- ğŸš€ é‡å¤§æ›´æ–°
- ğŸ”§ é…ç½®ä¿®æ”¹
- ğŸ“ æ–‡æ¡£æ›´æ–°
- ğŸ¨ UIæ”¹è¿›
- âš¡ æ€§èƒ½ä¼˜åŒ–
- ğŸ”’ å®‰å…¨ä¿®å¤

### å­˜å‚¨ç®¡ç†

#### è‡ªåŠ¨æ¸…ç†ç­–ç•¥
```bash
# ä¿ç•™æœ€è¿‘10ä¸ªæœ¬åœ°å¤‡ä»½ï¼Œåˆ é™¤æ—§å¤‡ä»½
./version-manager.sh cleanup 10

# å®šæœŸæ¸…ç†ï¼ˆå»ºè®®æ¯æœˆæ‰§è¡Œï¼‰
find backups/ -name "v*" -type d -mtime +30 -exec rm -rf {} \;
```

#### å­˜å‚¨ç©ºé—´ç›‘æ§
```bash
# æŸ¥çœ‹å¤‡ä»½å ç”¨ç©ºé—´
du -sh backups/

# æŸ¥çœ‹Dockeré•œåƒå ç”¨
docker images stock-tracker --format "table {{.Tag}}\t{{.Size}}"

# æ¸…ç†æ— ç”¨Dockeré•œåƒ
docker image prune -f
```

---

## ğŸš¨ æ•…éšœå¤„ç†

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. å®¹å™¨å¯åŠ¨å¤±è´¥
```bash
# é—®é¢˜ï¼šå›æ»šåå®¹å™¨æ— æ³•å¯åŠ¨
# è§£å†³ï¼š
docker logs stock-tracker-app  # æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker restart stock-tracker-app  # é‡å¯å®¹å™¨
# å¦‚æœä»å¤±è´¥ï¼Œå›æ»šåˆ°æ›´æ—©çš„ç¨³å®šç‰ˆæœ¬
./version-manager.sh restore v1.0.0
```

#### 2. ç½‘ç«™è®¿é—®å¼‚å¸¸
```bash
# é—®é¢˜ï¼šç½‘ç«™æ— æ³•è®¿é—®
# æ£€æŸ¥æ­¥éª¤ï¼š
docker ps | grep stock-tracker  # å®¹å™¨æ˜¯å¦è¿è¡Œ
curl http://127.0.0.1:3000     # æœ¬åœ°æ˜¯å¦æ­£å¸¸
systemctl status nginx         # åå‘ä»£ç†çŠ¶æ€
# è§£å†³ï¼šé‡å¯ç›¸å…³æœåŠ¡æˆ–å›æ»šç‰ˆæœ¬
```

#### 3. æ•°æ®åŠ è½½å¤±è´¥
```bash
# é—®é¢˜ï¼šè‚¡ç¥¨æ•°æ®æ— æ³•åŠ è½½
# æ£€æŸ¥ï¼š
cat .env.local                 # ç¯å¢ƒå˜é‡é…ç½®
docker logs stock-tracker-app | grep -i error  # APIé”™è¯¯æ—¥å¿—
# è§£å†³ï¼šæ£€æŸ¥Tushare tokenæˆ–å›æ»šåˆ°ç¨³å®šç‰ˆæœ¬
```

#### 4. GitHubæ¨é€å¤±è´¥
```bash
# é—®é¢˜ï¼šå¤‡ä»½æ—¶GitHubæ¨é€å¤±è´¥
# è§£å†³ï¼šæœ¬åœ°å’ŒDockerå¤‡ä»½ä»ç„¶æœ‰æ•ˆï¼ŒGitHubæ¨é€æ˜¯å¯é€‰çš„
# æ‰‹åŠ¨æ¨é€ï¼š
git push origin main --tags
```

### ç¾éš¾æ¢å¤æµç¨‹

#### å®Œå…¨ç³»ç»Ÿé‡å»º
```bash
# 1. é‡æ–°å…‹éš†é¡¹ç›®
cd /www/wwwroot/
git clone https://github.com/yushuo1991/911.git stock-tracker-new
cd stock-tracker-new

# 2. æ¢å¤ç¯å¢ƒé…ç½®
cp /path/to/backup/.env.local .

# 3. å›æ»šåˆ°ç¨³å®šç‰ˆæœ¬
git checkout v1.0.0

# 4. é‡æ–°éƒ¨ç½²
./deploy.sh

# 5. é…ç½®å®å¡”é¢æ¿åå‘ä»£ç†
# 6. éªŒè¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
```

---

## ğŸ”§ ç»´æŠ¤å»ºè®®

### å®šæœŸç»´æŠ¤ä»»åŠ¡

#### æ¯å‘¨ç»´æŠ¤ (10åˆ†é’Ÿ)
```bash
# 1. åˆ›å»ºç¨³å®šç‰ˆæœ¬å¤‡ä»½
./version-manager.sh backup patch "æ¯å‘¨ç¨³å®šç‰ˆæœ¬å¤‡ä»½"

# 2. æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
docker ps | grep stock-tracker
curl -I http://127.0.0.1:3000

# 3. æŸ¥çœ‹æ—¥å¿—æ˜¯å¦æœ‰å¼‚å¸¸
docker logs stock-tracker-app --tail 50

# 4. æ£€æŸ¥å­˜å‚¨ç©ºé—´
df -h
du -sh backups/
```

#### æ¯æœˆç»´æŠ¤ (30åˆ†é’Ÿ)
```bash
# 1. æ¸…ç†æ—§å¤‡ä»½
./version-manager.sh cleanup 10

# 2. æ›´æ–°ç³»ç»Ÿä¾èµ–
npm audit fix

# 3. æ£€æŸ¥Dockeré•œåƒ
docker images stock-tracker
docker image prune -f

# 4. å¤‡ä»½é‡è¦é…ç½®åˆ°å…¶ä»–ä½ç½®
cp -r backups/ /backup/external/stock-tracker/
```

#### æ¯å­£åº¦ç»´æŠ¤ (1å°æ—¶)
```bash
# 1. é‡å¤§ç‰ˆæœ¬å¤‡ä»½
./version-manager.sh backup major "å­£åº¦ç¨³å®šç‰ˆæœ¬"

# 2. ç³»ç»Ÿå®‰å…¨æ›´æ–°
apt update && apt upgrade

# 3. å®å¡”é¢æ¿æ›´æ–°
# 4. SSLè¯ä¹¦ç»­æœŸæ£€æŸ¥
# 5. æ€§èƒ½ä¼˜åŒ–è¯„ä¼°
```

### ç›‘æ§å»ºè®®

#### å…³é”®æŒ‡æ ‡ç›‘æ§
- **ç½‘ç«™å¯ç”¨æ€§**: https://bk.yushuo.click å“åº”æ—¶é—´
- **å®¹å™¨çŠ¶æ€**: Dockerå®¹å™¨è¿è¡ŒçŠ¶å†µ
- **ç£ç›˜ç©ºé—´**: å¤‡ä»½ç›®å½•å­˜å‚¨ä½¿ç”¨ç‡
- **å†…å­˜ä½¿ç”¨**: åº”ç”¨å†…å­˜å ç”¨æƒ…å†µ
- **APIå“åº”**: Tushareæ•°æ®è·å–æˆåŠŸç‡

#### å‘Šè­¦è®¾ç½®
```bash
# å¯åœ¨å®å¡”é¢æ¿è®¾ç½®ç›‘æ§å‘Šè­¦ï¼š
# - ç½‘ç«™å“åº”æ—¶é—´ > 5ç§’
# - ç£ç›˜ä½¿ç”¨ç‡ > 80%
# - å†…å­˜ä½¿ç”¨ç‡ > 90%
# - å®¹å™¨åœæ­¢è¿è¡Œ
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

```bash
# ç‰ˆæœ¬ç®¡ç†
./version-manager.sh version           # æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
./version-manager.sh list             # æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬
./version-manager.sh backup patch "æè¿°"  # åˆ›å»ºè¡¥ä¸ç‰ˆæœ¬
./version-manager.sh restore v1.0.0   # å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬

# å®¹å™¨ç®¡ç†
docker ps | grep stock-tracker        # æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker logs stock-tracker-app         # æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker restart stock-tracker-app      # é‡å¯å®¹å™¨
./deploy.sh                           # é‡æ–°éƒ¨ç½²

# æœåŠ¡æ£€æŸ¥
curl http://127.0.0.1:3000           # æœ¬åœ°æœåŠ¡æ£€æŸ¥
systemctl status nginx               # åå‘ä»£ç†çŠ¶æ€
cat VERSION                          # å½“å‰ç‰ˆæœ¬å·
```

### ç´§æ€¥è”ç³»

- **æœåŠ¡å™¨æä¾›å•†**: RackNerd
- **åŸŸåæœåŠ¡å•†**: (æ ¹æ®å®é™…æƒ…å†µ)
- **å®å¡”é¢æ¿**: http://107.173.154.147:8888
- **GitHubä»“åº“**: https://github.com/yushuo1991/911

---

## ğŸ“ æ›´æ–°æ—¥å¿—

| ç‰ˆæœ¬ | æ—¥æœŸ | æè¿° |
|------|------|------|
| v1.0.0 | 2025-09-23 | åˆå§‹ç¨³å®šç‰ˆæœ¬ï¼Œå®Œæ•´ä¸‰é‡å¤‡ä»½ç³»ç»Ÿ |

---

## ğŸ“‹ é™„å½•

### A. å¸¸è§é—®é¢˜è§£ç­” (FAQ)

#### Q1: å¦‚ä½•æŸ¥çœ‹å½“å‰è¿è¡Œçš„æ˜¯å“ªä¸ªç‰ˆæœ¬ï¼Ÿ
```bash
# æ–¹æ³•1ï¼šæŸ¥çœ‹VERSIONæ–‡ä»¶
cat VERSION

# æ–¹æ³•2ï¼šæŸ¥çœ‹Dockerå®¹å™¨æ ‡ç­¾
docker inspect stock-tracker-app | grep Image

# æ–¹æ³•3ï¼šè®¿é—®ç½‘ç«™æŸ¥çœ‹é¡µé¢ç‰ˆæœ¬ä¿¡æ¯
curl -s http://127.0.0.1:3000 | grep version
```

#### Q2: å¤‡ä»½å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ
```bash
# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# æ£€æŸ¥DockeræœåŠ¡çŠ¶æ€
systemctl status docker

# æ‰‹åŠ¨å¤‡ä»½å…³é”®æ–‡ä»¶
cp -r . ../manual-backup-$(date +%Y%m%d-%H%M%S)
```

#### Q3: å¦‚ä½•å¿«é€Ÿæ£€æŸ¥ç³»ç»Ÿå¥åº·çŠ¶æ€ï¼Ÿ
```bash
# ä½¿ç”¨å†…ç½®å¥åº·æ£€æŸ¥è„šæœ¬
./version-manager.sh health

# æ‰‹åŠ¨æ£€æŸ¥å…³é”®ç»„ä»¶
echo "=== ç³»ç»Ÿå¥åº·æ£€æŸ¥ ==="
echo "1. Dockerå®¹å™¨çŠ¶æ€:"
docker ps | grep stock-tracker
echo "2. ç½‘ç«™å“åº”:"
curl -I http://127.0.0.1:3000
echo "3. ç£ç›˜ç©ºé—´:"
df -h | grep -E "(/$|/www)"
echo "4. å†…å­˜ä½¿ç”¨:"
free -h
```

#### Q4: GitHubæ¨é€æ€»æ˜¯å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
```bash
# æ£€æŸ¥tokenæƒé™
git config --global credential.helper store
git config --global user.name "your-username"
git config --global user.email "your-email@example.com"

# å¦‚æœæ˜¯å¤§æ–‡ä»¶é—®é¢˜ï¼Œæ’é™¤Dockeré•œåƒ
echo "*.tar" >> .gitignore
echo "docker-image.tar" >> .gitignore
git add .gitignore
git commit -m "æ’é™¤å¤§æ–‡ä»¶"
```

### B. æ•…éšœæ’é™¤è„šæœ¬

#### ç³»ç»Ÿè¯Šæ–­è„šæœ¬
```bash
#!/bin/bash
# æ–‡ä»¶: diagnose.sh
echo "=== è‚¡ç¥¨è¿½è¸ªç³»ç»Ÿè¯Šæ–­æŠ¥å‘Š ==="
echo "ç”Ÿæˆæ—¶é—´: $(date)"
echo ""

echo "1. åŸºç¡€ä¿¡æ¯:"
echo "   å½“å‰ç‰ˆæœ¬: $(cat VERSION 2>/dev/null || echo 'æœªæ‰¾åˆ°ç‰ˆæœ¬æ–‡ä»¶')"
echo "   ç³»ç»Ÿæ—¶é—´: $(date)"
echo "   æœåŠ¡å™¨IP: $(curl -s ifconfig.me 2>/dev/null || echo 'æ— æ³•è·å–å¤–ç½‘IP')"
echo ""

echo "2. DockerçŠ¶æ€:"
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
echo ""

echo "3. æœåŠ¡æ£€æŸ¥:"
echo "   æœ¬åœ°æœåŠ¡: $(curl -s -o /dev/null -w "%{http_code}" http://127.0.0.1:3000)"
echo "   å¤–ç½‘è®¿é—®: $(curl -s -o /dev/null -w "%{http_code}" https://bk.yushuo.click 2>/dev/null || echo 'è¿æ¥å¤±è´¥')"
echo ""

echo "4. èµ„æºä½¿ç”¨:"
echo "   ç£ç›˜ç©ºé—´:"
df -h | grep -E "(/$|/www)"
echo "   å†…å­˜ä½¿ç”¨:"
free -h
echo ""

echo "5. å¤‡ä»½çŠ¶æ€:"
echo "   æœ¬åœ°å¤‡ä»½: $(ls -la backups/ 2>/dev/null | wc -l) ä¸ª"
echo "   Dockeré•œåƒ: $(docker images stock-tracker --format 'table {{.Tag}}\t{{.Size}}' 2>/dev/null | wc -l) ä¸ª"
echo ""

echo "6. æœ€è¿‘æ—¥å¿— (æœ€å10è¡Œ):"
docker logs stock-tracker-app --tail 10 2>/dev/null || echo "æ— æ³•è·å–æ—¥å¿—"
```

#### ç´§æ€¥ä¿®å¤è„šæœ¬
```bash
#!/bin/bash
# æ–‡ä»¶: emergency-fix.sh
echo "=== ç´§æ€¥ä¿®å¤è„šæœ¬ ==="

# 1. åœæ­¢å½“å‰å®¹å™¨
echo "1. åœæ­¢å½“å‰å®¹å™¨..."
docker stop stock-tracker-app 2>/dev/null

# 2. å›æ»šåˆ°æœ€æ–°ç¨³å®šç‰ˆæœ¬
echo "2. å›æ»šåˆ°æœ€æ–°ç¨³å®šç‰ˆæœ¬..."
LATEST_VERSION=$(ls -t backups/ | grep "^v" | head -1 | cut -d'-' -f1)
if [ -n "$LATEST_VERSION" ]; then
    ./version-manager.sh restore "$LATEST_VERSION"
    echo "å·²å›æ»šåˆ°ç‰ˆæœ¬: $LATEST_VERSION"
else
    echo "æœªæ‰¾åˆ°å¯ç”¨çš„å¤‡ä»½ç‰ˆæœ¬ï¼Œå°è¯•é‡å¯å½“å‰ç‰ˆæœ¬..."
    docker start stock-tracker-app
fi

# 3. éªŒè¯æ¢å¤
echo "3. éªŒè¯æœåŠ¡æ¢å¤..."
sleep 10
if curl -s http://127.0.0.1:3000 > /dev/null; then
    echo "âœ… æœåŠ¡æ¢å¤æ­£å¸¸"
else
    echo "âŒ æœåŠ¡ä»æœ‰é—®é¢˜ï¼Œéœ€è¦äººå·¥å¹²é¢„"
fi
```

### C. æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### å®šæœŸæ¸…ç†å‘½ä»¤
```bash
# åˆ›å»ºæ¸…ç†è„šæœ¬: cleanup.sh
#!/bin/bash
echo "=== ç³»ç»Ÿæ¸…ç†å¼€å§‹ ==="

# æ¸…ç†Dockeræ— ç”¨é•œåƒ
echo "1. æ¸…ç†Dockeré•œåƒ..."
docker image prune -f
docker system prune -f

# æ¸…ç†æ—§å¤‡ä»½(ä¿ç•™æœ€è¿‘5ä¸ª)
echo "2. æ¸…ç†æ—§å¤‡ä»½..."
cd backups/
ls -t | grep "^v" | tail -n +6 | xargs -r rm -rf
cd ..

# æ¸…ç†æ—¥å¿—æ–‡ä»¶
echo "3. æ¸…ç†æ—¥å¿—æ–‡ä»¶..."
find . -name "*.log" -mtime +7 -delete

echo "=== æ¸…ç†å®Œæˆ ==="
df -h
```

#### ç›‘æ§è„šæœ¬
```bash
#!/bin/bash
# æ–‡ä»¶: monitor.sh - æ”¾å…¥crontabæ¯5åˆ†é’Ÿè¿è¡Œä¸€æ¬¡
LOG_FILE="/www/wwwroot/stock-tracker/log/monitor.log"
mkdir -p log

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
if ! curl -s http://127.0.0.1:3000 > /dev/null; then
    echo "$(date): æœåŠ¡å¼‚å¸¸ï¼Œå°è¯•é‡å¯" >> $LOG_FILE
    docker restart stock-tracker-app
    sleep 30
    if curl -s http://127.0.0.1:3000 > /dev/null; then
        echo "$(date): é‡å¯æˆåŠŸ" >> $LOG_FILE
    else
        echo "$(date): é‡å¯å¤±è´¥ï¼Œéœ€è¦äººå·¥å¹²é¢„" >> $LOG_FILE
    fi
else
    echo "$(date): æœåŠ¡æ­£å¸¸" >> $LOG_FILE
fi
```

### D. å¿«é€Ÿå‚è€ƒå¡ç‰‡

#### ä¸€é”®å‘½ä»¤é€ŸæŸ¥è¡¨

| æ“ä½œ | å‘½ä»¤ | è¯´æ˜ |
|------|------|------|
| **æŸ¥çœ‹ç‰ˆæœ¬** | `cat VERSION` | å½“å‰ç‰ˆæœ¬å· |
| **å¿«é€Ÿå¤‡ä»½** | `./version-manager.sh backup patch "å¿«é€Ÿå¤‡ä»½"` | åˆ›å»ºè¡¥ä¸å¤‡ä»½ |
| **å¿«é€Ÿå›æ»š** | `./version-manager.sh restore v1.0.0` | å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬ |
| **é‡å¯æœåŠ¡** | `docker restart stock-tracker-app` | é‡å¯åº”ç”¨å®¹å™¨ |
| **æŸ¥çœ‹æ—¥å¿—** | `docker logs stock-tracker-app --tail 50` | æŸ¥çœ‹æœ€è¿‘50è¡Œæ—¥å¿— |
| **å¥åº·æ£€æŸ¥** | `curl -I http://127.0.0.1:3000` | æ£€æŸ¥æœåŠ¡çŠ¶æ€ |
| **ç£ç›˜æ£€æŸ¥** | `df -h` | æ£€æŸ¥ç£ç›˜ç©ºé—´ |
| **æ¸…ç†ç©ºé—´** | `docker system prune -f` | æ¸…ç†Dockerç©ºé—´ |

#### ç´§æ€¥æƒ…å†µå¤„ç†æµç¨‹

```
ç½‘ç«™æ— æ³•è®¿é—® â†’ æ£€æŸ¥å®¹å™¨çŠ¶æ€ â†’ é‡å¯å®¹å™¨ â†’ ä»å¤±è´¥ â†’ å›æ»šç‰ˆæœ¬ â†’ è”ç³»æŠ€æœ¯æ”¯æŒ
     â†“              â†“              â†“           â†“          â†“
1. curlæ£€æŸ¥      docker ps     docker restart  æœ€æ–°ç¨³å®šç‰ˆæœ¬  è®°å½•è¯¦ç»†é”™è¯¯
2. æµè§ˆå™¨éªŒè¯    å®¹å™¨æ˜¯å¦è¿è¡Œ    ç­‰å¾…30ç§’       ./version-manager.sh
3. ä¸åŒç½‘ç»œæµ‹è¯•  ç«¯å£æ˜¯å¦å¼€æ”¾    å†æ¬¡éªŒè¯       restore v1.0.0
```

---

## ğŸ“ å­¦ä¹ èµ„æº

### ç›¸å…³æŠ€æœ¯æ–‡æ¡£é“¾æ¥
- **Dockerå®˜æ–¹æ–‡æ¡£**: https://docs.docker.com/
- **Next.jséƒ¨ç½²æŒ‡å—**: https://nextjs.org/docs/deployment
- **å®å¡”é¢æ¿ä½¿ç”¨æ•™ç¨‹**: https://www.bt.cn/bbs/forum.php?mod=forumdisplay&fid=39
- **Gitç‰ˆæœ¬æ§åˆ¶**: https://git-scm.com/docs
- **Linuxå‘½ä»¤å‚è€ƒ**: https://man7.org/linux/man-pages/

### æŠ€æœ¯æ”¯æŒè”ç³»æ–¹å¼
- **GitHub Issues**: https://github.com/yushuo1991/911/issues
- **å®å¡”é¢æ¿**: http://107.173.154.147:8888
- **æœåŠ¡å™¨SSH**: root@107.173.154.147

---

*æœ€åæ›´æ–°æ—¶é—´: 2025å¹´9æœˆ23æ—¥*
*æ–‡æ¡£ç‰ˆæœ¬: v2.0*
*ç³»ç»ŸçŠ¶æ€: âœ… è¿è¡Œæ­£å¸¸*
*å¤‡ä»½çŠ¶æ€: âœ… ä¸‰é‡å¤‡ä»½å°±ç»ª*