# ğŸ”’ å®Œæ•´å¤‡ä»½æ“ä½œæŒ‡å—

## ğŸ¯ å¿«é€Ÿå¼€å§‹ - ä¸€é”®å¤‡ä»½

è¯·åœ¨SSHç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/stock-tracker

# 2. åˆ›å»ºå¤‡ä»½è„šæœ¬ï¼ˆå¤åˆ¶backup-current-version.shçš„å†…å®¹ï¼‰
# æˆ–è€…ä»æœ¬åœ°ä¸Šä¼ å·²åˆ›å»ºçš„è„šæœ¬

# 3. èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x backup-current-version.sh

# 4. æ‰§è¡Œå¤‡ä»½
./backup-current-version.sh
```

## ğŸ“¦ å¤‡ä»½å†…å®¹

è‡ªåŠ¨å¤‡ä»½è„šæœ¬ä¼šåˆ›å»ºä»¥ä¸‹å®Œæ•´å¤‡ä»½ï¼š

| ç±»åˆ« | å†…å®¹ | è¯´æ˜ |
|------|------|------|
| **Gitä»£ç ** | å®Œæ•´æºä»£ç  + ç‰ˆæœ¬æ ‡ç­¾ | tar.gzæ ¼å¼ï¼Œå«æ‰€æœ‰æ–‡ä»¶ |
| **Dockeré•œåƒ** | åº”ç”¨é•œåƒ + MySQLé•œåƒ | çº¦1-2GBï¼ŒåŒ…å«æ‰€æœ‰ä¾èµ– |
| **æ•°æ®åº“** | å®Œæ•´æ•°æ® + ç»“æ„ | gzipå‹ç¼©SQLï¼Œå«è§¦å‘å™¨ |
| **Nginxé…ç½®** | åå‘ä»£ç†é…ç½® + æ—¥å¿— | å¯ç›´æ¥æ¢å¤ä½¿ç”¨ |
| **åº”ç”¨æ—¥å¿—** | æœ€è¿‘1000è¡Œæ—¥å¿— | ç”¨äºé—®é¢˜æ’æŸ¥ |
| **ç¯å¢ƒä¿¡æ¯** | ç³»ç»Ÿé…ç½® + å®¹å™¨çŠ¶æ€ | è®°å½•è¿è¡Œç¯å¢ƒ |
| **æ¢å¤è„šæœ¬** | è‡ªåŠ¨æ¢å¤è„šæœ¬ | ä¸€é”®æ¢å¤åŠŸèƒ½ |

## ğŸ“ å¤‡ä»½ä½ç½®

å¤‡ä»½æ–‡ä»¶ä¿å­˜åœ¨ï¼š
```
/www/backup/stock-tracker/
â”œâ”€â”€ backup_20250930_120230/          # å¤‡ä»½ç›®å½•
â”‚   â”œâ”€â”€ code/                        # ä»£ç å¤‡ä»½
â”‚   â”œâ”€â”€ docker/                      # Dockerå¤‡ä»½
â”‚   â”œâ”€â”€ database/                    # æ•°æ®åº“å¤‡ä»½
â”‚   â”œâ”€â”€ nginx/                       # Nginxé…ç½®
â”‚   â”œâ”€â”€ logs/                        # æ—¥å¿—å¤‡ä»½
â”‚   â”œâ”€â”€ restore.sh                   # æ¢å¤è„šæœ¬
â”‚   â””â”€â”€ BACKUP-REPORT.txt           # å¤‡ä»½æŠ¥å‘Š
â””â”€â”€ stock-tracker-backup-20250930_120230.tar.gz  # å‹ç¼©åŒ…
```

## ğŸ’¾ ä¸‹è½½å¤‡ä»½åˆ°æœ¬åœ°

### æ–¹æ³•1: SCPå‘½ä»¤ï¼ˆæ¨èï¼‰

åœ¨ä½ çš„Windowsæœ¬åœ°æ‰§è¡Œï¼š

```bash
# ä¸‹è½½å®Œæ•´å¤‡ä»½åŒ…
scp root@yushuo.click:/www/backup/stock-tracker/stock-tracker-backup-*.tar.gz D:\Backups\

# æŸ¥çœ‹æœåŠ¡å™¨å¤‡ä»½æ–‡ä»¶åˆ—è¡¨
ssh root@yushuo.click "ls -lh /www/backup/stock-tracker/*.tar.gz"
```

### æ–¹æ³•2: WinSCPå·¥å…·

1. ä¸‹è½½WinSCP: https://winscp.net/
2. è¿æ¥æœåŠ¡å™¨ï¼š
   - ä¸»æœº: yushuo.click
   - ç«¯å£: 22
   - ç”¨æˆ·: root
   - å¯†ç : gJ75hNHdy90TA4qGo9
3. å¯¼èˆªåˆ° `/www/backup/stock-tracker/`
4. æ‹–æ‹½ä¸‹è½½å‹ç¼©åŒ…

## ğŸ”„ æ¢å¤å¤‡ä»½

### å¿«é€Ÿæ¢å¤

```bash
# 1. è§£å‹å¤‡ä»½
tar -xzf stock-tracker-backup-20250930_120230.tar.gz

# 2. è¿›å…¥å¤‡ä»½ç›®å½•
cd backup_20250930_120230

# 3. è¿è¡Œæ¢å¤è„šæœ¬
chmod +x restore.sh
./restore.sh

# 4. è¾“å…¥ YES ç¡®è®¤æ¢å¤
```

### éªŒè¯æ¢å¤

```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker compose ps

# æµ‹è¯•API
curl -I http://bk.yushuo.click/api/stocks?date=20250929&days=1

# æµè§ˆå™¨è®¿é—®
# http://bk.yushuo.click
```

## â° è®¾ç½®è‡ªåŠ¨å¤‡ä»½

### æ¯æ—¥è‡ªåŠ¨å¤‡ä»½

```bash
# ç¼–è¾‘å®šæ—¶ä»»åŠ¡
crontab -e

# æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½ï¼‰
0 2 * * * /www/wwwroot/stock-tracker/backup-current-version.sh >> /var/log/backup.log 2>&1

# ä¿å­˜é€€å‡ºï¼ˆæŒ‰ESCï¼Œè¾“å…¥:wqï¼Œå›è½¦ï¼‰

# æŸ¥çœ‹å®šæ—¶ä»»åŠ¡
crontab -l
```

### è‡ªåŠ¨æ¸…ç†æ—§å¤‡ä»½

```bash
# æ·»åŠ æ¸…ç†ä»»åŠ¡ï¼ˆæ¯å‘¨æ—¥å‡Œæ™¨3ç‚¹ï¼Œåˆ é™¤30å¤©å‰çš„å¤‡ä»½ï¼‰
crontab -e

# æ·»åŠ ï¼š
0 3 * * 0 find /www/backup/stock-tracker -name "*.tar.gz" -mtime +30 -delete
```

## ğŸ·ï¸ Gitç‰ˆæœ¬ç®¡ç†

å¤‡ä»½ä¼šè‡ªåŠ¨åˆ›å»ºGitæ ‡ç­¾ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬æ ‡ç­¾
git tag -l

# æŸ¥çœ‹æ ‡ç­¾è¯¦æƒ…
git show v4.2-stable-20250930

# å›æ»šåˆ°ç‰¹å®šç‰ˆæœ¬
git checkout v4.2-stable-20250930

# è¿”å›æœ€æ–°ç‰ˆæœ¬
git checkout main
```

## ğŸ“Š å¤‡ä»½å¤§å°å‚è€ƒ

| é¡¹ç›® | å¤§å° | è¯´æ˜ |
|------|------|------|
| ä»£ç  | ~50MB | å‹ç¼©å |
| åº”ç”¨é•œåƒ | ~500MB | å‹ç¼©å |
| MySQLé•œåƒ | ~200MB | å‹ç¼©å |
| æ•°æ®åº“ | 10-100MB | å–å†³äºæ•°æ®é‡ |
| é…ç½®+æ—¥å¿— | ~10MB | |
| **æ€»è®¡** | **~800MB-1GB** | å‹ç¼©åŒ…å¤§å° |

## âœ… å¤‡ä»½æ£€æŸ¥æ¸…å•

å®Œæˆå¤‡ä»½åéªŒè¯ï¼š

```bash
# 1. æ£€æŸ¥å¤‡ä»½ç›®å½•
ls -lh /www/backup/stock-tracker/

# 2. æŸ¥çœ‹å¤‡ä»½æŠ¥å‘Š
cat /www/backup/stock-tracker/backup_*/BACKUP-REPORT.txt

# 3. éªŒè¯å‹ç¼©åŒ…å®Œæ•´æ€§
tar -tzf /www/backup/stock-tracker/stock-tracker-backup-*.tar.gz | head -20

# 4. æ£€æŸ¥Gitæ ‡ç­¾
git tag -l | grep v4.2

# 5. æµ‹è¯•æ•°æ®åº“å¤‡ä»½
gunzip -t /www/backup/stock-tracker/backup_*/database/*.sql.gz
```

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: å¤‡ä»½å¤±è´¥"ç©ºé—´ä¸è¶³"
```bash
# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# æ¸…ç†Dockerç¼“å­˜
docker system prune -a

# åˆ é™¤æ—§å¤‡ä»½
rm -f /www/backup/stock-tracker/stock-tracker-backup-2024*.tar.gz
```

### Q: Gitæ ‡ç­¾å†²çª
```bash
# åˆ é™¤æ—§æ ‡ç­¾
git tag -d v4.2-stable-20250930
git push origin :refs/tags/v4.2-stable-20250930

# é‡æ–°åˆ›å»º
git tag -a v4.2-stable-20250930 -m "Backup"
git push origin v4.2-stable-20250930
```

### Q: æ•°æ®åº“å¤‡ä»½å¾ˆå¤§
```bash
# æ­£å¸¸æƒ…å†µï¼š
# - æ–°ç³»ç»Ÿ: 1-10MB
# - è¿è¡Œ1æœˆ: 10-100MB
# - è¿è¡Œ1å¹´: 100MB-1GB

# å‹ç¼©ç‡é€šå¸¸: 70-90%
```

## ğŸ” å®‰å…¨å»ºè®®

1. **å®šæœŸä¸‹è½½åˆ°æœ¬åœ°**
   - æ¯å‘¨ä¸‹è½½ä¸€æ¬¡å®Œæ•´å¤‡ä»½
   - ä¿å­˜åœ¨å¤–éƒ¨ç¡¬ç›˜æˆ–äº‘å­˜å‚¨

2. **åŠ å¯†æ•æ„Ÿå¤‡ä»½**
   ```bash
   # ä½¿ç”¨å¯†ç åŠ å¯†
   zip -e -r backup-encrypted.zip backup_20250930_120230/
   ```

3. **é™åˆ¶è®¿é—®æƒé™**
   ```bash
   chmod 700 /www/backup/stock-tracker
   ```

4. **å®šæœŸæµ‹è¯•æ¢å¤**
   - æ¯æœˆåœ¨æµ‹è¯•ç¯å¢ƒæµ‹è¯•æ¢å¤

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

- å¤‡ä»½è„šæœ¬ä½ç½®: `backup-current-version.sh`
- å¤‡ä»½å­˜å‚¨ä½ç½®: `/www/backup/stock-tracker/`
- æŸ¥çœ‹å¤‡ä»½æ—¥å¿—: `tail -f /var/log/backup.log`

---

**è®°ä½**: æ•°æ®æ— ä»·ï¼Œå®šæœŸå¤‡ä»½ï¼ ğŸ”’